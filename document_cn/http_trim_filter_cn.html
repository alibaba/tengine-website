<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>trim 模块 - The Tengine Web Server</title><meta name="description" content="该模块用于删除 html ， 内嵌 javascript 和 css 中的注释以及重复的空白符。location / &amp;#123;    trim on;    trim_js on;    trim_css on;&amp;#125;指令trim on | off默认: trim off上下文: http, server, location使模块有效（失效），删除 html 的注释以及重复的空白符（\n"><meta property="og:type" content="article"><meta property="og:title" content="trim 模块"><meta property="og:url" content="http://tengine.taobao.org/document_cn/http_trim_filter_cn.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="该模块用于删除 html ， 内嵌 javascript 和 css 中的注释以及重复的空白符。location / &amp;#123;    trim on;    trim_js on;    trim_css on;&amp;#125;指令trim on | off默认: trim off上下文: http, server, location使模块有效（失效），删除 html 的注释以及重复的空白符（\n"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-11-06T02:40:24.978Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="trim 模块"><meta name="twitter:description" content="该模块用于删除 html ， 内嵌 javascript 和 css 中的注释以及重复的空白符。location / &amp;#123;    trim on;    trim_js on;    trim_css on;&amp;#125;指令trim on | off默认: trim off上下文: http, server, location使模块有效（失效），删除 html 的注释以及重复的空白符（\n"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/ingress.html">Ingress</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Guide</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document_cn/http_trim_filter_cn" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">trim 模块</h1></header><div class="article-entry" itemprop="articleBody"><p>该模块用于删除 html ， 内嵌 javascript 和 css 中的注释以及重复的空白符。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    trim on;</span><br><span class="line">    trim_js on;</span><br><span class="line">    trim_css on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><blockquote><p><strong>trim</strong> <code>on</code> | <code>off</code><br><strong>默认:</strong> <code>trim off</code><br><strong>上下文:</strong> <code>http, server, location</code></p></blockquote><p>使模块有效（失效），删除 html 的注释以及重复的空白符（\n，\r，\t，&#39; &#39;）。</p><p>例外：对于 <code>pre</code>，<code>textarea</code>，<code>script</code>，<code>style</code> 和 ie/ssi/esi注释 等标签内的内容不作删除操作。</p><p>参数值可以包含变量。</p><p>例如：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set $flag &quot;off&quot;;</span><br><span class="line">if ($condition) &#123;</span><br><span class="line">set $flag &quot;on&quot;;</span><br><span class="line">&#125;</span><br><span class="line">trim $flag;</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>trim_js</strong> <code>on</code> | <code>off</code><br><strong>默认:</strong> <code>trim_js off</code><br><strong>上下文:</strong> <code>http, server, location</code></p></blockquote><p>使模块有效（失效），删除 html 内嵌 javascript 的注释以及重复的空白符（\n，\r，\t，&#39; &#39;）。</p><p>例外：对于非javascript代码的 <code>script</code> 标签内容不作删除操作。</p><p>参数值可以包含变量。</p><hr><blockquote><p><strong>trim_css</strong> <code>on</code> | <code>off</code><br><strong>默认:</strong> <code>trim_css off</code><br><strong>上下文:</strong> <code>http, server, location</code></p></blockquote><p>使模块有效（失效），删除 html 内嵌 css 的注释以及重复的空白符（\n，\r，\t，&#39; &#39;)。</p><p>例外：对于非css代码的 <code>style</code> 标签内容不作删除操作。</p><p>参数值可以包含变量。</p><hr><blockquote><p><strong>trim_types</strong> <code>MIME types</code><br><strong>默认:</strong> <code>trim_types: text/html</code><br><strong>上下文:</strong> <code>http, server, location</code></p></blockquote><p>定义哪些<a href="http://en.wikipedia.org/wiki/MIME_type" target="_blank" rel="noopener">MIME types</a>类型的响应可以被处理。</p><p>目前只能处理html格式的页面，js和css只针对于html内嵌的代码，不支持处理单独的js和css页面。</p><p>如果这样配置 <code>trim_type text/javascript;</code>，js代码将被作为html代码来处理而出错。</p><p>添加请求参数http_trim=off，将关闭trim功能，返回原始代码，方便对照调试。</p><p>格式如下:</p><p><code>http://www.xxx.com/index.html?http_trim=off</code></p><p>原始:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;textarea  &gt;</span><br><span class="line">trim</span><br><span class="line">module</span><br><span class="line">&lt;/textarea  &gt;</span><br><span class="line">&lt;!--remove all--&gt;</span><br><span class="line">&lt;!--[if IE]&gt; trim module &lt;![endif]--&gt;</span><br><span class="line">&lt;!--[if !IE ]&gt;--&gt; trim module  &lt;!--&lt;![endif]--&gt;</span><br><span class="line">&lt;!--# ssi--&gt;</span><br><span class="line">&lt;!--esi--&gt;</span><br><span class="line">&lt;pre    style  =</span><br><span class="line">&quot;color:   blue&quot;  &gt;Welcome    to    nginx!&lt;/pre  &gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">/***  muitl comment</span><br><span class="line">***/</span><br><span class="line">//// single comment</span><br><span class="line">str.replace(/     /,&quot;hello&quot;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style   type=&quot;text/css&quot;  &gt;</span><br><span class="line">/*** css comment</span><br><span class="line">! ***/</span><br><span class="line">body</span><br><span class="line">&#123;</span><br><span class="line">font-size:  20px ;</span><br><span class="line">line-height: 150% ;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>结果:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;textarea&gt;</span><br><span class="line">trim</span><br><span class="line">module</span><br><span class="line">&lt;/textarea&gt;</span><br><span class="line">&lt;!--[if IE]&gt; trim module &lt;![endif]--&gt;</span><br><span class="line">&lt;!--[if !IE ]&gt;--&gt; trim module  &lt;!--&lt;![endif]--&gt;</span><br><span class="line">&lt;!--# ssi--&gt;</span><br><span class="line">&lt;!--esi--&gt;</span><br><span class="line">&lt;pre style=&quot;color:   blue&quot;&gt;Welcome    to    nginx!&lt;/pre&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;str.replace(/     /,&quot;hello&quot;);&lt;/script&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;body&#123;font-size:20px;line-height:150%;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><h5 id="空白符"><a href="#空白符" class="headerlink" title="空白符"></a>空白符</h5><ul><li>正文中的 <code>\r</code> 直接删除。</li><li>正文中的 <code>\t</code> 替换为空格，然后重复的空格保留一个。</li><li>正文中重复的 <code>\n</code> 保留一个。</li><li>标签中的 <code>\t</code>，<code>\n</code> 替换为空格，重复的空格保留一个，<code>=</code> 前后的空格直接删除，<code>&gt;</code> 前面的空格直接删除。</li><li>标签的双引号和单引号内的空白符不做删除。</li><li><code>pre</code> 和 <code>texterea</code> 标签的内容不做删除。</li><li>支持 <code>pre</code> 嵌套使用。</li><li><code>script</code> 和 <code>style</code> 标签的内容不做删除。</li><li>ie条件注释的内容不做删除。</li><li>ssi/esi注释的内容不做删除。</li></ul><h5 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h5><ul><li>如果是ie条件注释不做删除。<br>判断规则：<code>&lt;!--[if &lt;![endif]--&gt;</code> 之间的内容判断为ie条件注释。</li><li>如果是ssi/esi注释的内容不做删除。<br>判断规则：<code>&lt;!--# --&gt;</code> <code>&lt;!--esi --&gt;</code> 之间的内容分别判断为ssi和esi注释。</li><li>其他正常html注释直接删除. <code>&lt;!-- --&gt;</code></li></ul><h3 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h3><ul><li><p>借鉴 jsmin 的处理规则 (<a href="http://www.crockford.com/javascript/jsmin.html" target="_blank" rel="noopener">http://www.crockford.com/javascript/jsmin.html</a>)</p></li><li><p><code>&lt;script type=&quot;text/javascript&quot;&gt;</code> 或者 <code>&lt;script&gt;</code> 标签认为是javascript。</p></li></ul><h4 id="空白符-1"><a href="#空白符-1" class="headerlink" title="空白符"></a>空白符</h4><ul><li>&#39;(&#39;，&#39;[&#39;，&#39;{&#39;，&#39;;&#39;，&#39;,&#39;，&#39;&gt;&#39;，&#39;=&#39; 后的 &#39;\n&#39;，&#39;\t&#39;，空格 直接删除。</li><li>&#39;\r&#39; 直接删除。- 其他情况 重复的 &#39;\n&#39;，&#39;\t&#39;，空格 保留第一个。- 单引号和双引号内不删除。</li></ul><h4 id="如下不做操作："><a href="#如下不做操作：" class="headerlink" title="如下不做操作："></a>如下不做操作：</h4><ul><li>&quot;hello &nbsp; \&quot; &nbsp; world&quot;</li><li>&#39;hello &nbsp; \&#39; &nbsp; world&#39;- 正则表达式的内容不删除。</li><li>判断规则：&#39;/&#39; 前的非空字符是 &#39;,&#39;，&#39;(&#39;，&#39;=&#39; 三种的即认为是正则表达式。( 同jsmin的判断)</li></ul><h4 id="如下不做操作：-1"><a href="#如下不做操作：-1" class="headerlink" title="如下不做操作："></a>如下不做操作：</h4><ul><li><code>var re=/1 &amp;nbsp; &amp;nbsp; &amp;nbsp;2/;</code></li><li><code>data.match(/1 &amp;nbsp; &amp;nbsp; 2/);</code></li></ul><h3 id="注释-1"><a href="#注释-1" class="headerlink" title="注释"></a>注释</h3><ul><li>删除单行注释。 <code>//</code>- 删除多行注释。 <code>/- */</code></li><li>注意：javascript也有一种条件注释，不过貌似用得很少，jsmin直接删除的，trim也是直接删除。</li><li><a href="http://en.wikipedia.org/wiki/Conditional_comment" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Conditional_comment</a></li></ul><h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><ul><li><p>借鉴 YUI Compressor 的处理规则 (<a href="http://yui.github.io/yuicompressor/css.html" target="_blank" rel="noopener">http://yui.github.io/yuicompressor/css.html</a>)</p></li><li><p><code>&lt;style type=&quot;text/css&quot;&gt;</code> 或者 <code>&lt;style&gt;</code> 标签认为是css。</p></li></ul><h5 id="空白符-2"><a href="#空白符-2" class="headerlink" title="空白符"></a>空白符</h5><ul><li>&#39;;&#39;，&#39;&gt;&#39;，&#39;{&#39;，&#39;}&#39;，&#39;:&#39;，&#39;,&#39; 前后的 &#39;\n&#39;，&#39;\t&#39;，空格 直接删除。- &#39;\r&#39; 直接删除。- 其他情况 连续的 &#39;\n&#39;， &#39;\t&#39; 和 空格 保留为一个空格。- 单引号和双引号内不删除。</li></ul><h4 id="如下不做操作：-2"><a href="#如下不做操作：-2" class="headerlink" title="如下不做操作："></a>如下不做操作：</h4><ul><li>&quot;hello &nbsp; \\&quot; &nbsp; world&quot;</li><li>&#39;hello &nbsp; \&#39; &nbsp; &nbsp; world&#39;</li></ul><h5 id="注释-2"><a href="#注释-2" class="headerlink" title="注释"></a>注释</h5><ul><li>child seletor hack的注释不删除。</li><li><code>html&gt;/**/body p{color:blue}</code>- IE5 /Mac hack 的注释不删除。</li><li><code>/*\*/.selector{color:khaki}/**/</code>- 其他情况删除注释。 <code>/- */</code></li></ul></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>