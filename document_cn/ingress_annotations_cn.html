<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Tengine-Ingress - The Tengine Web Server</title><meta name="description" content="Tengine-Ingress完全兼容云原生ingress标准规范，用户可参照kubernetes ingress-nginx相关文档。在此列出Tengine-Ingress原生扩展和增强功能的Annotations。下述所有Annotations的变更生效都无需tengine reload，注解配置无损实时动态生效，长连接保持不变，成功率不受影响，配置变更效率提升翻倍，网关稳定性进一步得到增强。"><meta property="og:type" content="article"><meta property="og:title" content="Tengine-Ingress"><meta property="og:url" content="http://tengine.taobao.org/document_cn/ingress_annotations_cn.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="Tengine-Ingress完全兼容云原生ingress标准规范，用户可参照kubernetes ingress-nginx相关文档。在此列出Tengine-Ingress原生扩展和增强功能的Annotations。下述所有Annotations的变更生效都无需tengine reload，注解配置无损实时动态生效，长连接保持不变，成功率不受影响，配置变更效率提升翻倍，网关稳定性进一步得到增强。"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-07-21T06:56:49.781Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tengine-Ingress"><meta name="twitter:description" content="Tengine-Ingress完全兼容云原生ingress标准规范，用户可参照kubernetes ingress-nginx相关文档。在此列出Tengine-Ingress原生扩展和增强功能的Annotations。下述所有Annotations的变更生效都无需tengine reload，注解配置无损实时动态生效，长连接保持不变，成功率不受影响，配置变更效率提升翻倍，网关稳定性进一步得到增强。"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/ingress.html">Ingress</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Guide</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document_cn/ingress_annotations_cn" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Tengine-Ingress</h1></header><div class="article-entry" itemprop="articleBody"><p><code>Tengine-Ingress</code>完全兼容云原生<a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">ingress</a>标准规范，用户可参照<a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">kubernetes ingress-nginx</a>相关文档。</p><p>在此列出<a href="https://github.com/alibaba/tengine-ingress" target="_blank" rel="noopener">Tengine-Ingress</a>原生扩展和增强功能的Annotations。</p><p><strong>下述所有Annotations的变更生效都无需tengine reload，注解配置无损实时动态生效，长连接保持不变，成功率不受影响，配置变更效率提升翻倍，网关稳定性进一步得到增强。</strong><br><strong>对于文档<a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">kubernetes ingress-nginx</a>中的注解，如果不在下述Annotations列表范围，则暂不支持动态生效。</strong></p><h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ssl-redirect</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>true</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code></p></blockquote><p>强制HTTPS：Ingress注解<code>nginx.ingress.kubernetes.io/ssl-redirect</code>，生效维度是<code>域名</code>，<code>域名/Path</code>继承<code>域名/</code>相同的<code>ssl-redirect</code>。<br>默认强制HTTPS<code>nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;</code>，即HTTP请求会被301重定向到HTTPS，客户端接收到301 HTTPS，需要通过TLS建链发送HTTPS请求到网关<code>Tengine-Ingress</code>。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/proxy-read-timeout</code><br>值类型: <code>number</code><br>默认值: <code>60</code><br>单位: <code>秒</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>后端响应超时时间：Ingress注解<code>nginx.ingress.kubernetes.io/proxy-read-timeout</code>，生效维度是<code>域名</code>或<code>域名/path</code>，相同域名不同path可以设置不同的<code>proxy-read-timeout</code>。<br>请求从网关<code>Tengine-Ingress</code>向后端upstream发送后，等待后端upstream返回响应的最大时长，网关默认等待60秒，超过60秒未接收到upstream的响应报文，则网关<code>Tengine-Ingress</code>返回客户端HTTP 504错误响应消息。</p><h3 id="高级路由"><a href="#高级路由" class="headerlink" title="高级路由"></a>高级路由</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/canary</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>false</code><br>注解类型: <code>canary ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>高级路由标识</p><ul><li>如果Ingress资源对象有注解<code>nginx.ingress.kubernetes.io/canary: &quot;true&quot;</code>，则实际为Canary Ingress资源对象，专用于HTTP高级路由。</li><li>一个Canary Ingress资源对象定义一个高级路由，必须包含有注解<code>nginx.ingress.kubernetes.io/canary: &quot;true&quot;</code>。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/canary-by-header</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>canary ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>基于请求header的高级路由</p><ul><li>基于请求Header的流量切分，当用于高级路由header的值等于<code>always</code>，则请求将被转发到指定的后端upstream。</li><li>当请求消息中不存在用于高级路由的header，或者header值不等于<code>always</code>，则路由规则不生效。</li><li>路由规则匹配，但用于高级路由的后端upstream不存在，则请求会被降级路由到<code>主域名</code>对应的后端upstream。</li><li>所谓<code>主域名</code>即Ingress资源对象中的host，全部相同host的Canary Ingress资源对象都是隶属于<code>主域名</code>的高级路由。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/canary-by-header-value</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>canary ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>基于请求header值的高级路由</p><ul><li>在上述基于请求header的高级路由基础上，可以指定具体匹配的header值，在header和header值完全匹配的情况下，请求将被转发到指定的后端upstream。</li><li>当请求消息中不存在用于高级路由的header和header值，则路由规则不生效。</li><li>路由规则匹配，但用于高级路由的后端upstream不存在，则请求会被降级路由到<code>主域名</code>对应的后端upstream。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/canary-weight</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>canary ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>基于服务权重的高级路由</p><ul><li>基于服务权重的流量切分，其优先级低于上述基于请求header和header值的高级路由，优先级从高到低依次为 Header&amp;Header值 --&gt; Cookie --&gt; 服务权重。</li><li>刨除上述基于请求header和header值的高级路由请求，其他所有请求消息将按照服务权重比例转发到指定的后端upstream。</li><li>例如：后端upstream=gray，服务权重=5，则5%请求被转发到后端upstream=gray，其它95%请求会被转发到<code>主域名</code>对应的后端upstream。</li><li>当高级路由的服务权重被设置为100，则所有请求消息都将默认转发到高级路由配置的后端upstream，请求消息将不再转发到<code>主域名</code>对应的后端upstream。</li></ul><h3 id="网页爬虫"><a href="#网页爬虫" class="headerlink" title="网页爬虫"></a>网页爬虫</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/disable-robots</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>false</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code></p></blockquote><p>禁止搜索引擎收录：默认允许网页爬虫，设置<code>nginx.ingress.kubernetes.io/disable-robots: &quot;true&quot;</code>，则禁止对应用域名执行网络爬虫。</p><h3 id="CORS-跨域资源共享"><a href="#CORS-跨域资源共享" class="headerlink" title="CORS (跨域资源共享)"></a>CORS (跨域资源共享)</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/enable-cors</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>false</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>开启跨域资源共享：默认禁止跨域资源共享，如果设置<code>nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;</code>，则应用域名开启跨域资源共享。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/cors-allow-origin</code><br>值类型: <code>string</code><br>默认值: <code>*</code><br>值格式：<code>&lt;origin&gt;[, &lt;origin&gt;] | *</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>服务端允许跨域请求的源列表：默认允许所有源都可以跨域资源请求。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/cors-max-age</code><br>值类型: <code>number</code><br>默认值: <code>1728000</code><br>单位: <code>秒</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>预检请求的响应内容可缓存的最大时间：有效期内客户端跨域资源请求都不再需要预检请求。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/cors-allow-credentials</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>true</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>用于控制是否允许在跨域请求中携带认证信息：认证信息含cookies，header Authorization，客户端证书。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/cors-allow-methods</code><br>值类型: <code>string</code><br>默认值: <code>GET, PUT, POST, DELETE, PATCH, OPTIONS</code><br>值格式：<code>&lt;method&gt;[, &lt;method&gt;]*</code><br>值校验：<code>以&#39;,&#39;分割，只允许字母</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>服务端允许跨域资源请求的HTTP Method列表。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/cors-allow-headers</code><br>值类型: <code>string</code><br>默认值: <code>DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization</code><br>值格式：<code>&lt;header-name&gt;[, &lt;header-name&gt;]*</code><br>值校验：<code>以&#39;,&#39;分割，只允许字母，数字，_ 和 -</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>服务端允许跨域资源请求的HTTP Header列表。</p><h3 id="来源标识"><a href="#来源标识" class="headerlink" title="来源标识"></a>来源标识</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ingress-referrer</code><br>值类型: <code>string</code><br>默认值: <code></code><br>值格式：<code>&lt;referrer&gt;[, &lt;referrer&gt;]</code><br>值校验：<code>以&#39;,&#39;分割</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>注解<code>nginx.ingress.kubernetes.io/ingress-referrer</code>用于标识Ingress资源对象的来源。<br>网关<code>Tengine-Ingress</code>基于configmap的配置<code>ingress-referrer</code>，校验Ingress资源对象的来源是否在授权允许创建Ingress资源对象的应用列表中。<br>以下场景的ingress资源对象将被丢弃处理：</p><ul><li>注解ingress-referrer值非空，且不在configmap配置<code>ingress-referrer</code>授权应用列表中。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/canary-referrer</code><br>值类型: <code>string</code><br>默认值: <code></code><br>值格式：<code>&lt;referrer&gt;[, &lt;referrer&gt;]</code><br>值校验：<code>以&#39;,&#39;分割</code><br>注解类型: <code>canary ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>注解<code>nginx.ingress.kubernetes.io/canary-referrer</code>用于标识Canary Ingress资源对象的来源。<br>网关<code>Tengine-Ingress</code>基于configmap的配置<code>canary-referrer</code>，校验Canary Ingress资源对象的来源是否在授权允许创建Canary Ingress资源对象的应用列表中。<br>以下场景的ingress资源对象将被丢弃处理：</p><ul><li>注解canary-referrer值非空，且不在configmap配置<code>canary-referrer</code>授权应用列表中。</li></ul><h3 id="Ingress分批次滚动生效"><a href="#Ingress分批次滚动生效" class="headerlink" title="Ingress分批次滚动生效"></a>Ingress分批次滚动生效</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ingress-rollout</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>false</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Ingress资源对象分批次滚动生效开关</p><ul><li><strong>注意：为了使用Ingress域名资源对象的分批次滚动生效功能，Tengine-Ingress需要以StatefulSet形式部署发布。</strong></li><li>如果注解<code>nginx.ingress.kubernetes.io/ingress-rollout: &quot;true&quot;</code>，ingress资源对象将在网关<code>Tengine-Ingress</code>集群内部分批次滚动生效，<strong>无需tengine reload</strong>，实时动态无损生效。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ingress-rollout-current-revision</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Ingress资源对象的当前运行版本号</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ingress-rollout-update-revision</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Ingress资源对象的升级版本号</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/ingress-rollout-index-id</code><br>值类型: <code>number</code><br>默认值: <code>-1</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Ingress资源对象的生效范围</p><ul><li>网关<code>Tengine-Ingress</code>集群需要以statefulset形式部署发布，0..N-1为Tengine-Ingress的Pod序号，从0开始到N-1结束。</li><li>例如：网关<code>Tengine-Ingress</code>集群有10个实例，则Tengine-Ingress的Pod序号的为0..9。</li><li>只有Pod序号小于<code>ingress-rollout-index-id</code>的Tengine-Ingress实例才会动态更新ingress资源对象。</li></ul><h3 id="Secret分批次滚动生效"><a href="#Secret分批次滚动生效" class="headerlink" title="Secret分批次滚动生效"></a>Secret分批次滚动生效</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/secret-rollout</code><br>值类型: <code>true</code> 或 <code>false</code><br>默认值: <code>false</code><br>注解类型: <code>secret注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Secret资源对象分批次滚动生效开关</p><ul><li><strong>注意：为了使用Ingress域名资源对象的分批次滚动生效功能，Tengine-Ingress需要以StatefulSet形式部署发布。</strong></li><li>如果注解<code>nginx.ingress.kubernetes.io/secret-rollout: &quot;true&quot;</code>，secret资源对象将在网关<code>Tengine-Ingress</code>集群内部分批次滚动生效，<strong>无需tengine reload</strong>，实时动态无损生效。</li></ul><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/secret-rollout-current-revision</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>secret注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Secret资源对象的当前运行版本号</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/secret-rollout-update-revision</code><br>值类型: <code>string</code><br>默认值: <code></code><br>注解类型: <code>secret注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Secret资源对象的升级版本号</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/secret-rollout-index-id</code><br>值类型: <code>number</code><br>默认值: <code>-1</code><br>注解类型: <code>secret注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Secret资源对象的生效范围</p><ul><li>网关<code>Tengine-Ingress</code>集群需要以statefulset形式部署发布，0..N-1为Tengine-Ingress的Pod序号，从0开始到N-1结束。</li><li>只有Pod序号小于<code>secret-rollout-index-id</code>的Tengine-Ingress实例才会动态更新secret资源对象。</li></ul><h3 id="全局一致性校验"><a href="#全局一致性校验" class="headerlink" title="全局一致性校验"></a>全局一致性校验</h3><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/version</code><br>值类型: <code>number</code><br>默认值: <code>0</code><br>注解类型: <code>ingress注解</code><br>生效维度: <code>域名</code> 或 <code>域名/path</code></p></blockquote><p>Ingress资源对象的ID号：唯一标识一个ingress资源对象。</p><hr><blockquote><p>注解名称: <code>nginx.ingress.kubernetes.io/version</code><br>值类型: <code>number</code><br>默认值: <code>0</code><br>注解类型: <code>secret注解</code><br>生效维度: <code>证书</code></p></blockquote><p>Secret资源对象的ID号：唯一标识一个secret资源对象。</p></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>