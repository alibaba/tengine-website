<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Ngx_http_trim_filter - The Tengine Web Server</title><meta name="description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces (spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim mod"><meta property="og:type" content="article"><meta property="og:title" content="Ngx_http_trim_filter"><meta property="og:url" content="http://tengine.taobao.org/document/http_trim_filter.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces (spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim mod"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2018-11-10T11:15:13.867Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ngx_http_trim_filter"><meta name="twitter:description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces (spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim mod"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/documentation.html">Document</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="http://tengine.taobao.org/book/" target="_blank">Guide</a></li><li role="presentation"><a class="menu-item" href="http://click.aliyun.com/m/4339/" target="_blank">Buy Server</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/http_trim_filter" class="article article-type-post" itemscope="" itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Ngx_http_trim_filter</h1></header><div class="article-entry" itemprop="articleBody"><p>The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces (spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim module parses HTML with a state machine.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    trim on;</span><br><span class="line">    trim_js on;</span><br><span class="line">    trim_css on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h2><blockquote><p><strong>trim</strong> <code>on</code> | <code>off</code><br><strong>Default:</strong> <code>trim off</code><br><strong>Context:</strong> <code>http, server, location</code></p></blockquote><p>Enable or disable trim module for pure HTML.</p><p>This module will retain some contents unchanged, in case that they are enclosed by the tag <code>pre</code>,<code>textarea</code>,<code>script</code> and <code>style</code>,as well as IE/SSI/ESI comments.</p><p>Parameter value can contain variables.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set $flag &quot;off&quot;;</span><br><span class="line">if ($condition) &#123;</span><br><span class="line">set $flag &quot;on&quot;;</span><br><span class="line">&#125;</span><br><span class="line">trim $flag;</span><br></pre></td></tr></table></figure><hr><blockquote><p><strong>trim_js</strong> <code>on</code> | <code>off</code><br><strong>Default:</strong> <code>trim_js off</code><br><strong>Context:</strong> <code>http, server, location</code></p></blockquote><p>Enable or disable trim module for inline javascript.</p><p>Parameter value can contain variables too.</p><hr><blockquote><p><strong>trim_css</strong> <code>on</code> | <code>off</code><br><strong>Default:</strong> <code>trim_css off</code><br><strong>Context:</strong> <code>http, server, location</code></p></blockquote><p>Enable or disable trim module for inline css.</p><p>Parameter value can contain variables too.</p><hr><blockquote><p><strong>trim_types</strong> <code>MIME types</code><br><strong>Default:</strong> <code>trim_types: text/html</code><br><strong>Context:</strong> <code>http, server, location</code></p></blockquote><p>Enable trim module for the specified MIME types in addition to &quot;text/html&quot;. Responses with the “text/html” type are always processed.</p><p>Trim module will be disabled if incoming request has <code>http_trim=off</code> parameter in url.</p><p>e.g. <code>http://www.xxx.com/index.html?http_trim=off</code></p><p>original:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;textarea  &gt;</span><br><span class="line">trim</span><br><span class="line">module</span><br><span class="line">&lt;/textarea  &gt;</span><br><span class="line">&lt;!--remove all--&gt;</span><br><span class="line">&lt;!--[if IE]&gt; trim module &lt;![endif]--&gt;</span><br><span class="line">&lt;!--[if !IE ]&gt;--&gt; trim module  &lt;!--&lt;![endif]--&gt;</span><br><span class="line">&lt;!--# ssi--&gt;</span><br><span class="line">&lt;!--esi--&gt;</span><br><span class="line">&lt;pre    style  =</span><br><span class="line">&quot;color:   blue&quot;  &gt;Welcome    to    nginx!&lt;/pre  &gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">/***  muitl comment</span><br><span class="line">***/</span><br><span class="line">//// single comment</span><br><span class="line">str.replace(/     /,&quot;hello&quot;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style   type=&quot;text/css&quot;  &gt;</span><br><span class="line">/*** css comment</span><br><span class="line">! ***/</span><br><span class="line">body</span><br><span class="line">&#123;</span><br><span class="line">font-size:  20px ;</span><br><span class="line">line-height: 150% ;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>result:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;textarea&gt;</span><br><span class="line">trim</span><br><span class="line">module</span><br><span class="line">&lt;/textarea&gt;</span><br><span class="line">&lt;!--[if IE]&gt; trim module &lt;![endif]--&gt;</span><br><span class="line">&lt;!--[if !IE ]&gt;--&gt; trim module  &lt;!--&lt;![endif]--&gt;</span><br><span class="line">&lt;!--# ssi--&gt;</span><br><span class="line">&lt;!--esi--&gt;</span><br><span class="line">&lt;pre style=&quot;color:   blue&quot;&gt;Welcome    to    nginx!&lt;/pre&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;str.replace(/     /,&quot;hello&quot;);&lt;/script&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;body&#123;font-size:20px;line-height:150%;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="Html"><a href="#Html" class="headerlink" title="Html"></a>Html</h3><h5 id="Whitespace"><a href="#Whitespace" class="headerlink" title="Whitespace"></a>Whitespace</h5><ul><li>Remove &#39;\r&#39;.</li><li>Replace &#39;\t&#39; with space.</li><li>Replace multiple spaces with a single space.</li><li>Replace multiple &#39;\n&#39; with a single &#39;\n&#39;.</li><li>Replace multiple &#39;\n&#39; and &#39;\t&#39; in tag with a single space.</li><li>Do not trim quoted strings in tag.</li><li>Do not trim the contents enclosed by the tag <code>pre</code>,<code>textarea</code>,<code>script</code> and <code>style</code>.</li></ul><h5 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h5><ul><li>Remove html comment(<code>&amp;lt;!-- --&amp;gt;</code>).</li><li>Do not trim IE/SSI/ESI comments.<br>IE comment: <code>&amp;lt;!--[if &amp;lt;![endif]--&amp;gt;</code><br>SSI comment: <code>&amp;lt;!--# --&amp;gt;</code><br>ESI comment: <code>&amp;lt;!--esi --&amp;gt;</code></li></ul><h3 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h3><p>Contents enclosed by <code>&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;</code> or <code>&amp;lt;script&amp;gt;</code> will be identified as javascript.</p><h5 id="Whitespace-1"><a href="#Whitespace-1" class="headerlink" title="Whitespace"></a>Whitespace</h5><ul><li>Remove &#39;\r&#39;.</li><li>Remove &#39;\t&#39;,&#39;\n&#39; and space that behind &#39;(&#39;,&#39;,&#39;,&#39;=&#39;,&#39;:&#39;,&#39;[&#39;,&#39;!&#39;,&#39;&amp;&#39;,&#39;|&#39;,&#39;?&#39;,&#39;;&#39;,&#39;&gt;&#39;,&#39;~&#39;,&#39;*&#39;,&#39;{&#39;.</li><li>Replace multiple spaces with a single space.</li><li>Do not trim quoted strings and regular expression literals.</li></ul><h5 id="Comment-1"><a href="#Comment-1" class="headerlink" title="Comment"></a>Comment</h5><ul><li>Remove single comment. <code>//</code></li><li>Remove multi comment. <code>/* */</code></li></ul><h3 id="Css"><a href="#Css" class="headerlink" title="Css"></a>Css</h3><p>Contents enclosed by <code>&amp;lt;style type=&quot;text/css&quot;&amp;gt;</code> or <code>&amp;lt;style&amp;gt;</code> will be identified as css.</p><h5 id="Whiltespace"><a href="#Whiltespace" class="headerlink" title="Whiltespace"></a>Whiltespace</h5><ul><li>Remove &#39;\r&#39;.</li><li>Remove &#39;\t&#39;,&#39;\n&#39; and space that around &#39;;&#39;,&#39;&gt;&#39;,&#39;{&#39;,&#39;}&#39;,&#39;:&#39;,&#39;,&#39;.</li><li>Replace multiple &#39;\n&#39; and spaces with a single space.</li><li>Do not trim quoted strings.</li></ul><h5 id="Comment-2"><a href="#Comment-2" class="headerlink" title="Comment"></a>Comment</h5><ul><li>Remove css comment(<code>/* */</code>).</li><li>Do not remove child seletor and IE5 /Mac hack comments.<br>Child seletor hack: <code>html&amp;gt;/**/body p{color:blue}</code><br>IE5 /Mac hack: <code>/*\*/.selector{color:khaki}/**/</code><br><code>`</code></li></ul><div class="advertisement"><h3>Advertisement</h3><p><a href="http://click.aliyun.com/m/7689/" target="_blank"><img src="https://img.alicdn.com/tps/TB1c1imOpXXXXacXFXXXXXXXXXX-360-120.jpg"></a></p></div></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2018 <a href="http://www.alibabagroup.com/en/global/home" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine" target="_blank">Tengine</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>