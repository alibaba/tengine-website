<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Ngx_http_trim_filter - The Tengine Web Server</title><meta name="description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces(spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim modu"><meta property="og:type" content="article"><meta property="og:title" content="Ngx_http_trim_filter"><meta property="og:url" content="http://tengine.taobao.org/document/http_trim_filter.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces(spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim modu"><meta property="og:updated_time" content="2016-12-02T03:55:19.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ngx_http_trim_filter"><meta name="twitter:description" content="The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces(spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim modu"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="fluid-container global-header"><div class="container"><div class="header clearfix"><nav id="nav-menu"><ul class="nav nav-pills pull-right"><li role="presentation"><a class="menu-item" href="/download.html">下载</a></li><li role="presentation"><a class="menu-item" href="/source.html">源码</a></li><li role="presentation"><a class="menu-item" href="/documentation.html">文档</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation"><a class="menu-item" href="/contact.html">联系我们</a></li><li role="presentation"><a class="menu-item" href="http://tengine.taobao.org/book/">教程</a></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav><h1 class="text-muted site-logo"><a href="/" id="logo">The Tengine Web Server</a></h1></div></div></div><div class="outer"><section id="main"><div class="fluid-container"><div class="container"><article id="post-document/http_trim_filter" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Ngx_http_trim_filter</h1></header><div class="article-entry" itemprop="articleBody"><p>The ngx_http_trim_filter module is a filter that modifies a response by removing unnecessary whitespaces<br>(spaces, tabs, newlines) and comments from HTML (including inline javascript and css). Trim module parses<br>HTML with a state machine.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">location / {</div><div class="line">trim on;</div><div class="line">trim_js on;</div><div class="line">trim_css on;</div><div class="line">}</div></pre></td></tr></table></figure><p><strong>trim</strong> <code>on</code> | <code>off</code></p><p><strong>Default:</strong> <code>trim off</code></p><p><strong>Context:</strong> <code>http, server, location</code></p><p>Enable or disable trim module for pure HTML.</p><p>This module will retain some contents unchanged, in case that they are enclosed by the tag <code>pre</code>,<code>textarea</code>,<code>script</code> and <code>style</code>,as well as IE/SSI/ESI comments.</p><p>Parameter value can contain variables.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">set $flag &quot;off&quot;;</div><div class="line">if ($condition) {</div><div class="line">set $flag &quot;on&quot;;</div><div class="line">}</div><div class="line">trim $flag;</div></pre></td></tr></table></figure><p><strong>trim_js</strong> <code>on</code> | <code>off</code></p><p><strong>Default:</strong> <code>trim_js off</code></p><p><strong>Context:</strong> <code>http, server, location</code></p><p>Enable or disable trim module for inline javascript.</p><p>Parameter value can contain variables too.</p><p><strong>trim_css</strong> <code>on</code> | <code>off</code></p><p><strong>Default:</strong> <code>trim_css off</code></p><p><strong>Context:</strong> <code>http, server, location</code></p><p>Enable or disable trim module for inline css.</p><p>Parameter value can contain variables too.</p><p><strong>trim_types</strong> <code>MIME types</code></p><p><strong>Default:</strong> <code>trim_types: text/html</code></p><p><strong>Context:</strong> <code>http, server, location</code></p><p>Enable trim module for the specified MIME types in addition to &#x201C;text/html&#x201D;. Responses with the &#x201C;text/html&#x201D; type are always processed.</p><p>Trim module will be disabled if incoming request has <code>http_trim=off</code> parameter in url.</p><p>e.g. <code>http://www.xxx.com/index.html?http_trim=off</code></p><p>original:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&amp;lt;!DOCTYPE html&amp;gt;</div><div class="line">&amp;lt;textarea  &amp;gt;</div><div class="line">trim</div><div class="line">module</div><div class="line">&amp;lt;/textarea  &amp;gt;</div><div class="line">&amp;lt;!--remove all--&amp;gt;</div><div class="line">&amp;lt;!--[if IE]&amp;gt; trim module &amp;lt;![endif]--&amp;gt;</div><div class="line">&amp;lt;!--[if !IE ]&amp;gt;--&amp;gt; trim module  &amp;lt;!--&amp;lt;![endif]--&amp;gt;</div><div class="line">&amp;lt;!--# ssi--&amp;gt;</div><div class="line">&amp;lt;!--esi--&amp;gt;</div><div class="line">&amp;lt;pre    style  =</div><div class="line">&quot;color:   blue&quot;  &amp;gt;Welcome    to    nginx!&amp;lt;/pre  &amp;gt;</div><div class="line">&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;</div><div class="line">/***  muitl comment</div><div class="line">***/</div><div class="line">//// single comment</div><div class="line">str.replace(/     /,&quot;hello&quot;);</div><div class="line">&amp;lt;/script&amp;gt;</div><div class="line">&amp;lt;style   type=&quot;text/css&quot;  &amp;gt;</div><div class="line">/*** css comment</div><div class="line">! ***/</div><div class="line">body</div><div class="line">{</div><div class="line">font-size:  20px ;</div><div class="line">line-height: 150% ;</div><div class="line">}</div><div class="line">&amp;lt;/style&amp;gt;</div></pre></td></tr></table></figure><p>result:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">&amp;lt;!DOCTYPE html&amp;gt;</div><div class="line">&amp;lt;textarea&amp;gt;</div><div class="line">trim</div><div class="line">module</div><div class="line">&amp;lt;/textarea&amp;gt;</div><div class="line">&amp;lt;!--[if IE]&amp;gt; trim module &amp;lt;![endif]--&amp;gt;</div><div class="line">&amp;lt;!--[if !IE ]&amp;gt;--&amp;gt; trim module  &amp;lt;!--&amp;lt;![endif]--&amp;gt;</div><div class="line">&amp;lt;!--# ssi--&amp;gt;</div><div class="line">&amp;lt;!--esi--&amp;gt;</div><div class="line">&amp;lt;pre style=&quot;color:   blue&quot;&amp;gt;Welcome    to    nginx!&amp;lt;/pre&amp;gt;</div><div class="line">&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;str.replace(/     /,&quot;hello&quot;);&amp;lt;/script&amp;gt;</div><div class="line">&amp;lt;style type=&quot;text/css&quot;&amp;gt;body{font-size:20px;line-height:150%;}&amp;lt;/style&amp;gt;</div><div class="line"></div><div class="line">### Html</div><div class="line"></div><div class="line">##### Whitespace</div><div class="line"></div><div class="line">*   Remove &apos;\r&apos;.</div><div class="line">*   Replace &apos;\t&apos; with space.</div><div class="line">*   Replace multiple spaces with a single space.</div><div class="line">*   Replace multiple &apos;\n&apos; with a single &apos;\n&apos;.</div><div class="line">*   Replace multiple &apos;\n&apos; and &apos;\t&apos; in tag with a single space.</div><div class="line">*   Do not trim quoted strings in tag.</div><div class="line">*   Do not trim the contents enclosed by the tag `pre`,`textarea`,`script` and `style`.</div><div class="line"></div><div class="line">##### Comment</div><div class="line"></div><div class="line">*   Remove html comment(`&amp;lt;!-- --&amp;gt;`).</div><div class="line">*   Do not trim IE/SSI/ESI comments.</div><div class="line">IE comment: `&amp;lt;!--[if  &amp;lt;![endif]--&amp;gt;`</div><div class="line">SSI comment: `&amp;lt;!--#  --&amp;gt;`</div><div class="line">ESI comment: `&amp;lt;!--esi  --&amp;gt;`</div><div class="line"></div><div class="line">### Javascript</div><div class="line"></div><div class="line">Contents enclosed by `&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;` or `&amp;lt;script&amp;gt;` will be identified as javascript.</div><div class="line"></div><div class="line">##### Whitespace</div><div class="line"></div><div class="line">*   Remove &apos;\r&apos;.</div><div class="line">*   Remove &apos;\t&apos;,&apos;\n&apos; and space that behind &apos;(&apos;,&apos;,&apos;,&apos;=&apos;,&apos;:&apos;,&apos;[&apos;,&apos;!&apos;,&apos;&amp;amp;&apos;,&apos;|&apos;,&apos;?&apos;,&apos;;&apos;,&apos;&gt;&apos;,&apos;~&apos;,&apos;*&apos;,&apos;{&apos;.</div><div class="line">*   Replace multiple spaces with a single space.</div><div class="line">*   Do not trim quoted strings and regular expression literals.</div><div class="line"></div><div class="line">##### Comment</div><div class="line"></div><div class="line">*   Remove single comment. `//`</div><div class="line">*   Remove multi comment. `/*  */`</div><div class="line"></div><div class="line">### Css</div><div class="line"></div><div class="line">Contents enclosed by `&amp;lt;style type=&quot;text/css&quot;&amp;gt;` or `&amp;lt;style&amp;gt;` will be identified as css.</div><div class="line"></div><div class="line">##### Whiltespace</div><div class="line"></div><div class="line">*   Remove &apos;\r&apos;.</div><div class="line">*   Remove &apos;\t&apos;,&apos;\n&apos; and space that around &apos;;&apos;,&apos;&gt;&apos;,&apos;{&apos;,&apos;}&apos;,&apos;:&apos;,&apos;,&apos;.</div><div class="line">*   Replace multiple &apos;\n&apos; and spaces with a single space.</div><div class="line">*   Do not trim quoted strings.</div><div class="line"></div><div class="line">##### Comment</div><div class="line"></div><div class="line">*   Remove css comment(`/* */`).</div><div class="line">*   Do not remove child seletor and IE5 /Mac hack comments.</div><div class="line">Child seletor hack: `html&amp;gt;/**/body p{color:blue}`</div><div class="line">IE5 /Mac hack: `/*\*/.selector{color:khaki}/**/`</div></pre></td></tr></table></figure></div></div></article></div></div></section></div><div class="fluid-container global-footer"><div class="container"><div class="row"><div class="col-lg-6"><div class="footer-logo"></div></div><div class="col-lg-6 clearfix"><select class="lang-switch pull-right"></select></div></div><div class="row"><div class="col-lg-12"><span class="footer-text copyright">&copy; 2011-2016 Alibaba Inc. All rights reserved.</span> <span class="footer-text design-by">Designed by 阿里云UED AX</span></div></div></div></div><script src="/js/jquery.min.js"></script><script src="/js/particles.min.js"></script><script src="/js/app.min.js"></script></body></html>