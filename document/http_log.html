<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>ngx_http_log_module - The Tengine Web Server</title><meta name="description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><meta property="og:type" content="article"><meta property="og:title" content="ngx_http_log_module"><meta property="og:url" content="http://tengine.taobao.org/document/http_log.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><meta property="og:updated_time" content="2016-12-02T06:48:33.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ngx_http_log_module"><meta name="twitter:description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="fluid-container global-header"><div class="container"><div class="header clearfix"><nav id="nav-menu"><ul class="nav nav-pills pull-right"><li role="presentation"><a class="menu-item" href="/download.html">下载</a></li><li role="presentation"><a class="menu-item" href="/source.html">源码</a></li><li role="presentation"><a class="menu-item" href="/documentation.html">文档</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation"><a class="menu-item" href="/contact.html">联系我们</a></li><li role="presentation"><a class="menu-item" href="http://tengine.taobao.org/book/">教程</a></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav><h1 class="text-muted site-logo"><a href="/" id="logo">The Tengine Web Server</a></h1></div></div></div><div class="outer"><section id="main"><div class="fluid-container"><div class="container"><article id="post-document/http_log" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">ngx_http_log_module</h1></header><div class="article-entry" itemprop="articleBody"><p>Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:</p><p>./configure --with-syslog</p><p>The syslog module can talk directly to syslogd or syslog-ng.</p><p>og sampling is also possible in tengine to reduce the count of log records.</p><h2 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h2><p>Syntax: <strong>access_log</strong> log_target [format [ratio=ratio] [buffer=size]] | off</p><p>Default: access_log logs/access.log combined ratio=1</p><p>Context: http, server, location</p><p>Basically, you can use it as same as nginx&#39;s &#39;access_log&#39;, and you can write down &#39;ratio&#39; and &#39;buffer&#39; after &#39;format&#39; in any order.<br>Moreover, there are several enhancements:</p><ol><li><a href="#log_target">log_target</a></li><li><a href="#ratio">ratio</a></li></ol><h2 id="log-target"><a href="#log-target" class="headerlink" title="log_target"></a>log_target</h2><p>It&#39;s compatible with the log_file parameter, while three new log media types are supported:</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">file:/path/to/file</div><div class="line">syslog:facility[:[loglevel][:[target_ip:[target_port] | target_udgram_addr][:ident]]]</div><div class="line">&quot;pipe:/path/to/exec [param1 param2 ...]&quot;</div></pre></td></tr></table></figure><ul><li>&#39;file&#39;<br>Disk file, which is the same as the nginx&#39;s.</li><li><p>&#39;syslog&#39;</p><p>Support logging via syslog (UDP).</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">facility := auth | authpriv | cron | daemon | ftp | kern | lpr | mail | mark</div><div class="line">          | news | security | syslog | user | uucp | local0 | local1 | local2</div><div class="line">          | local3 | local4 | local5 | local6 | local7</div><div class="line">loglevel := crit | err | error | emerg | panic | alert | warn | warning</div><div class="line">          | info | notice | debug</div><div class="line"></div><div class="line">        The default loglevel is &apos;info&apos;.</div><div class="line"></div><div class="line">    target_ip[:target_port]:</div><div class="line"></div><div class="line">        The IP address and port of destination server. The default port is 514.</div><div class="line">    And UDP is the only supported protocol.</div><div class="line"></div><div class="line">    target_udgram_addr:</div><div class="line"></div><div class="line">        Specify the address of unix_dgram. The default address is &quot;/dev/log&quot;.</div><div class="line">    UNIX DGRAM is the only supported protocol.</div><div class="line"></div><div class="line">    ident:</div><div class="line"></div><div class="line">        Specify the mark for your application.</div></pre></td></tr></table></figure><p>Here are a few examples:</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user:info:127.0.0.1:514:ident</div></pre></td></tr></table></figure><p>Log to 127.0.0.1:514, with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><pre><code>The output is something like this:
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">May  4 15:44:15 local ident[26490]: XXXXXXXX</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:auth:err:10.232.4.28::ident</div></pre></td></tr></table></figure><p>Log to 10.232.4.28:514, with facility &#39;auth&#39;, level &#39;err&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user:info:/dev/log:ident</div></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user::/dev/log:ident</div></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;user&#39;, default level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user:info::ident</div></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:cron:debug:/dev/log</div></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;cron&#39;, level &#39;debug&#39; and default ident &#39;NGINX&#39;.</p><pre><code>The output is something like this:
</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">May  4 15:44:15 local NGINX[26490]: XXXXXXXX</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user::127.0.0.1</div></pre></td></tr></table></figure><p>Log to 127.0.0.1:514, with facility &#39;user&#39;, default level &#39;info&#39; and default ident &#39;NGINX&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user:debug</div></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;debug&#39; and default ident &#39;NGINX&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">syslog:user</div></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, default level &#39;info&#39; and default ident &#39;NGINX&#39;.</p><ul><li>&#39;pipe&#39;</li></ul><p>Since there may be space characters, the pipe name should be wrapped by quotes.</p><pre><code>The privilege of the pipe is the same the worker process (default user and group are &apos;nobody&apos;).
</code></pre><h2 id="ratio"><a href="#ratio" class="headerlink" title="ratio"></a>ratio</h2><p>Specify a sampling ratio.</p><p>For example, ratio=0.0001, which means tengine will log only once in every 10000 records.</p><p>This parameter must be explicitly specified, e.g. ratio=1, if you want to use the &#39;buffer&#39; parameter.</p><p>Syntax: <strong>error_log</strong> log_target [debug | info | notice | warn | error | crit]</p><p>Default: error_log logs/error.log</p><p>Context: core, http, server, location</p><p>Syslog and pipe are also supported, which is similar to &#39;access_log&#39;.</p><p>Syntax: <strong>syslog_retry_interval</strong> seconds</p><p>Default: syslog_retry_interval 1800</p><p>Context: core</p><p>The retry interval in case tengine fails to connect to the remote syslog server.</p><p>Syntax: <strong>log_escape</strong> on | off | ascii</p><p>Default: log_escape on</p><p>Context: core, http, server, location</p><ul><li>&#39;on&#39;: escape the special characters (exclude the <a href="http://en.wikipedia.org/wiki/Percent-encoding#Types_of_URI_characters" target="_blank" rel="external">reserved or unreserved characters</a>) in your access log.</li><li>&#39;off&#39;: don&#39;t escape the special characters.</li><li>&#39;acsii&#39;: only escape the invisible characters in the ACSII table.</li></ul></div></div></article></div></div></section></div><div class="fluid-container global-footer"><div class="container"><div class="row"><div class="col-lg-6"><div class="footer-logo"></div></div><div class="col-lg-6 clearfix"><select class="lang-switch pull-right"></select></div></div><div class="row"><div class="col-lg-12"><span class="footer-text copyright">&copy; 2011-2016 Alibaba Inc. All rights reserved.</span> <span class="footer-text design-by">Designed by 阿里云UED AX</span></div></div></div></div><script src="/js/jquery.min.js"></script><script src="/js/particles.min.js"></script><script src="/js/app.min.js"></script></body></html>