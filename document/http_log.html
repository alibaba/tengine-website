<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>ngx_http_log_module - The Tengine Web Server</title><meta name="description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><meta property="og:type" content="article"><meta property="og:title" content="ngx_http_log_module"><meta property="og:url" content="http://tengine.taobao.org/document/http_log.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-11-07T10:08:07.685Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ngx_http_log_module"><meta name="twitter:description" content="Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:./configure --with-syslogThe syslog module can talk directly to syslogd or syslog-ng.og sampli"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Tengine-Ingress</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/http_log" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">ngx_http_log_module</h1></header><div class="article-entry" itemprop="articleBody"><p>Logging via syslog and pipe is supported in tengine. To use it, you should enable the syslog module first:</p><p><code>./configure --with-syslog</code></p><p>The syslog module can talk directly to syslogd or syslog-ng.</p><p>og sampling is also possible in tengine to reduce the count of log records.</p><h2 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h2><blockquote><p>Syntax: <strong>access_log</strong> log_target [format [ratio=ratio] [buffer=size]] | off<br>Default: access_log logs/access.log combined ratio=1<br>Context: http, server, location</p></blockquote><p>Basically, you can use it as same as nginx&#39;s &#39;access_log&#39;, and you can write down &#39;ratio&#39; and &#39;buffer&#39; after &#39;format&#39; in any order.<br>Moreover, there are several enhancements:</p><ol><li><a href="#log_target">log_target</a></li><li><a href="#ratio">ratio</a></li></ol><h3 id="log-target"><a href="#log-target" class="headerlink" title="log_target"></a>log_target</h3><p>It&#39;s compatible with the log_file parameter, while three new log media types are supported:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file:/path/to/file</span><br><span class="line">syslog:facility[:[loglevel][:[target_ip:[target_port] | target_udgram_addr][:ident]]]</span><br><span class="line">&quot;pipe:/path/to/exec [param1 param2 ...]&quot;</span><br></pre></td></tr></table></figure><ul><li>&#39;file&#39;<br>Disk file, which is the same as the nginx&#39;s.</li><li><p>&#39;syslog&#39;</p><p>Support logging via syslog (UDP).</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">facility := auth | authpriv | cron | daemon | ftp | kern | lpr | mail | mark</span><br><span class="line">          | news | security | syslog | user | uucp | local0 | local1 | local2</span><br><span class="line">          | local3 | local4 | local5 | local6 | local7</span><br><span class="line">loglevel := crit | err | error | emerg | panic | alert | warn | warning</span><br><span class="line">          | info | notice | debug</span><br><span class="line"></span><br><span class="line">        The default loglevel is &apos;info&apos;.</span><br><span class="line"></span><br><span class="line">    target_ip[:target_port]:</span><br><span class="line"></span><br><span class="line">        The IP address and port of destination server. The default port is 514.</span><br><span class="line">    And UDP is the only supported protocol.</span><br><span class="line"></span><br><span class="line">    target_udgram_addr:</span><br><span class="line"></span><br><span class="line">        Specify the address of unix_dgram. The default address is &quot;/dev/log&quot;.</span><br><span class="line">    UNIX DGRAM is the only supported protocol.</span><br><span class="line"></span><br><span class="line">    ident:</span><br><span class="line"></span><br><span class="line">        Specify the mark for your application.</span><br></pre></td></tr></table></figure><p>Here are a few examples:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user:info:127.0.0.1:514:ident</span><br></pre></td></tr></table></figure><p>Log to 127.0.0.1:514, with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><p>The output is something like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">May  4 15:44:15 local ident[26490]: XXXXXXXX</span><br><span class="line"></span><br><span class="line">syslog:auth:err:10.232.4.28::ident</span><br></pre></td></tr></table></figure><p>Log to 10.232.4.28:514, with facility &#39;auth&#39;, level &#39;err&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user:info:/dev/log:ident</span><br></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user::/dev/log:ident</span><br></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;user&#39;, default level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user:info::ident</span><br></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;info&#39; and ident &#39;ident&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:cron:debug:/dev/log</span><br></pre></td></tr></table></figure><p>Log to local Unix dgram(/dev/log), with facility &#39;cron&#39;, level &#39;debug&#39; and default ident &#39;NGINX&#39;.</p><p>The output is something like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">May  4 15:44:15 local NGINX[26490]: XXXXXXXX</span><br><span class="line">syslog:user::127.0.0.1</span><br></pre></td></tr></table></figure><p>Log to 127.0.0.1:514, with facility &#39;user&#39;, default level &#39;info&#39; and default ident &#39;NGINX&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user:debug</span><br></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, level &#39;debug&#39; and default ident &#39;NGINX&#39;.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">syslog:user</span><br></pre></td></tr></table></figure><p>Log to default local Unix dgram(/dev/log), with facility &#39;user&#39;, default level &#39;info&#39; and default ident &#39;NGINX&#39;.</p><ul><li>&#39;pipe&#39;</li></ul><p>Since there may be space characters, the pipe name should be wrapped by quotes.</p><pre><code>The privilege of the pipe is the same the worker process (default user and group are &apos;nobody&apos;).
</code></pre><h2 id="ratio"><a href="#ratio" class="headerlink" title="ratio"></a>ratio</h2><p>Specify a sampling ratio.</p><p>For example, ratio=0.0001, which means tengine will log only once in every 10000 records.</p><p>This parameter must be explicitly specified, e.g. ratio=1, if you want to use the &#39;buffer&#39; parameter.</p><hr><blockquote><p>Syntax: <strong>error_log</strong> log_target [debug | info | notice | warn | error | crit]<br>Default: error_log logs/error.log<br>Context: core, http, server, location</p></blockquote><p>Syslog and pipe are also supported, which is similar to &#39;access_log&#39;.</p><hr><blockquote><p>Syntax: <strong>syslog_retry_interval</strong> seconds<br>Default: syslog_retry_interval 1800<br>Context: core</p></blockquote><p>The retry interval in case tengine fails to connect to the remote syslog server.</p><hr><blockquote><p>Syntax: <strong>log_escape</strong> on | off | ascii<br>Default: log_escape on<br>Context: core, http, server, location</p></blockquote><ul><li>&#39;on&#39;: escape the special characters (exclude the <a href="http://en.wikipedia.org/wiki/Percent-encoding#Types_of_URI_characters" target="_blank" rel="noopener">reserved or unreserved characters</a>) in your access log.</li><li>&#39;off&#39;: don&#39;t escape the special characters.</li><li>&#39;acsii&#39;: only escape the invisible characters in the ACSII table.</li></ul></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>