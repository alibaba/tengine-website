<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>ngx_http_sysguard_module - The Tengine Web Server</title><meta name="description" content="This module can be used to protect your server in case system load, memory use goes too high or requests are responded too slow.To use this module, you should enable it first:./configure --with-http_s"><meta property="og:type" content="article"><meta property="og:title" content="ngx_http_sysguard_module"><meta property="og:url" content="http://tengine.taobao.org/document/http_sysguard.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="This module can be used to protect your server in case system load, memory use goes too high or requests are responded too slow.To use this module, you should enable it first:./configure --with-http_s"><meta property="og:updated_time" content="2016-12-02T13:28:15.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ngx_http_sysguard_module"><meta name="twitter:description" content="This module can be used to protect your server in case system load, memory use goes too high or requests are responded too slow.To use this module, you should enable it first:./configure --with-http_s"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="fluid-container global-header"><div class="container"><div class="header row clearfix"><div class="col-sm-4 col-lg-2"><h1 class="text-muted site-logo"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><nav id="nav-menu" class="clearfix col-sm-8 col-lg-10 hide"><ul class="nav nav-pills pull-right"><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/documentation.html">Document</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="http://tengine.taobao.org/book/">Guilde</a></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div><div class="outer"><section id="main"><div class="fluid-container"><div class="container"><article id="post-document/http_sysguard" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">ngx_http_sysguard_module</h1></header><div class="article-entry" itemprop="articleBody"><p>This module can be used to protect your server in case system load, memory use goes too high or requests are responded too slow.</p><p>To use this module, you should enable it first:</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">./configure --with-http_sysguard_module</div></pre></td></tr></table></figure><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">server &#123;</div><div class="line">    sysguard on;</div><div class="line">    </div><div class="line">    sysguard_load load=10.5 action=/loadlimit;</div><div class="line">    sysguard_mem swapratio=20% action=/swaplimit;</div><div class="line">    sysguard_mem free=100M action=/freelimit;</div><div class="line">    sysguard_rt  rt=0.01 period=5s action=/rtlimit;</div><div class="line">    </div><div class="line">    location /loadlimit &#123;</div><div class="line">        return 503;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    location /swaplimit &#123;</div><div class="line">        return 503;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    location /freelimit &#123;</div><div class="line">        return 503;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    location /rtlimit &#123;</div><div class="line">        return 503;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Note this module requires the sysinfo(2) system call, or getloadavg(3) function in glibc. It also requires the /proc file system to get memory information.</p><h2 id="Directive"><a href="#Directive" class="headerlink" title="Directive"></a>Directive</h2><blockquote><p>Syntax: <strong>sysguard</strong> [on | off]<br>Default: sysguard off<br>Context: http, server, location</p></blockquote><p>Turn on or off this module.</p><hr><blockquote><p>Syntax: <strong>sysguard_load</strong> load=number [action=/url]<br>Default: none<br>Context: http, server, location</p></blockquote><p>Specify the load threshold.</p><p>When the system load exceeds this threshold, all subsequent requests will be redirected to the URL specified by the &#39;action&#39; parameter. Tengine will return 503 if there&#39;s no &#39;action&#39; URL defined. This directive also support using ncpu<em>ratio to instead of the fixed threshold, &#39;ncpu&#39; means the number of cpu&#39;s cores, you can use this directive like this: load=ncpu</em>1.5</p><hr><blockquote><p>Syntax: <strong>sysguard_mem</strong> [swapratio=ratio%] [free=size] [action=/url]<br>Default: none<br>Context: http, server, location</p></blockquote><p>Specify the used swap memory or free memory threshold.</p><p>When the swap memory use ratio exceeds this threshold or memory free less than the size, all subsequent requests will be redirected to the URL specified by the &#39;action&#39; parameter. Tengine will return 503 if there&#39;s no &#39;action&#39; URL. Sysguard uses this strategy to calculate memory free: &quot;memfree = free + buffered + cached&quot;</p><hr><blockquote><p>Syntax: <strong>sysguard_rt</strong> [rt=second] [period=time] [action=/url]<br>Default: none<br>Context: http, server, location</p></blockquote><p>Specify the response time threshold.</p><p>Parameter rt is used to set a threshold of the average response time, in second. Parameter period is used to specifiy the period of the statistics cycle. If the average response time of the system exceeds the threshold specified by the user, the incoming request will be redirected to a specified url which is defined by parameter &#39;action&#39;. If no &#39;action&#39; is presented, the request will be responsed with 503 error directly.</p><hr><blockquote><p>Syntax: <strong>sysguard_mode</strong> [and | or]<br>Default: sysguard_mode or<br>Context: http, server, location</p></blockquote><p>If there are more than one type of monitor, this directive is used to specified the relations among all the monitors which are: &#39;and&#39; for all matching and &#39;or&#39; for any matching.</p><hr><blockquote><p>Syntax: <strong>sysguard_interval</strong> time<br>Default: sysguard_interval 1s<br>Context: http, server, location</p></blockquote><p>Specify the time interval to update your system information.</p><p>The default value is one second, which means tengine updates the server status once a second.</p><hr><blockquote><p>Syntax: <strong>sysguard_log_level</strong> [info | notice | warn | error]<br>Default: sysguard_log_level error<br>Context: http, server, location</p></blockquote><p>Specify the log level of sysguard.</p></div></div></article></div></div></section></div><div class="fluid-container global-footer"><div class="container"><div class="row"><div class="col-lg-6"><div class="footer-logo"></div></div><div class="col-lg-6 clearfix"><select class="lang-switch pull-right"></select></div></div><div class="row"><div class="col-lg-12"><span class="footer-text copyright">&copy; 2011-2016 Alibaba Inc. All rights reserved.</span> <span class="footer-text design-by">Designed by 阿里云UED AX</span></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>