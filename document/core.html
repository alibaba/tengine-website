<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Core functionality - The Tengine Web Server</title><meta name="description" content="DirectivesSyntax: force_exit exit_time;Default: —Context: mainforce worker processes to exit after exit_time.The force_exit support is not enabled by default. You should compile it explicitly:./config"><meta property="og:type" content="article"><meta property="og:title" content="Core functionality"><meta property="og:url" content="http://tengine.taobao.org/document/core.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="DirectivesSyntax: force_exit exit_time;Default: —Context: mainforce worker processes to exit after exit_time.The force_exit support is not enabled by default. You should compile it explicitly:./config"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-11-06T12:30:21.677Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Core functionality"><meta name="twitter:description" content="DirectivesSyntax: force_exit exit_time;Default: —Context: mainforce worker processes to exit after exit_time.The force_exit support is not enabled by default. You should compile it explicitly:./config"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Tengine-Ingress</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/core" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Core functionality</h1></header><div class="article-entry" itemprop="articleBody"><h2 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h2><hr><blockquote><p>Syntax: <strong>force_exit</strong> exit_time;<br>Default: —<br>Context: main</p></blockquote><p>force worker processes to exit after exit_time.</p><p>The force_exit support is not enabled by default. You should compile it explicitly:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./configure --with-force-exit</span><br></pre></td></tr></table></figure><p>Note: Removed force_exit directive after the Tengine-2.3.0 version and use Nginx official <code>worker_shutdown_timeout</code> , detailed reference <a href="http://nginx.org/en/docs/ngx_core_module.html#worker_shutdown_timeout" target="_blank" rel="noopener">worker_shutdown_timeout</a></p><hr><blockquote><p>Syntax: <strong>worker_processes</strong> [num | auto]<br>Default: worker_processes auto<br>Context: main</p></blockquote><p>Set the number of worker processes.<br>When set to &#39;auto&#39;, which is also the default behavior, Tengine will create the same number of worker processes as your CPUs.</p><hr><blockquote><p>Syntax: <strong>master_env</strong> variable[=value];<br>Default: -<br>Context: main</p></blockquote><p>If use master_env directive to set NGX_DNS_RESOLVE_BACKUP_PATH environment variable and dns cache will be enabled.<br>When the dns server is unavailable, it&#39;s will use the last dns cache.</p><p>For example &#39;master_env NGX_DNS_RESOLVE_BACKUP_PATH=/home/tengine/worker/dnscache/path&#39;, the domain A record results will be saved to the file and path depends on &#39;NGX_DNS_RESOLVE_BACKUP_PATH&#39;.</p><hr><blockquote><p>Syntax: <strong>worker_cpu_affinity</strong> [mask1 mask2 mask3 ... | auto | off]<br>Default: worker_cpu_affinity off<br>Context: main</p></blockquote><p>Bind worker processes to the sets of CPUs.<br>When set to &#39;auto&#39;, Tengine will automatically bind each worker process to a specific CPU. If the number of worker processes is larger than the number of your CPUs, then the rest of worker processes will be bond in descendant order. For example, if there are 8 CPUs in your system:</p><ul><li><p>When the process number set to 4, the binding bitmap will be:</p><p>10000000 01000000 00100000 00010000</p></li><li><p>When the process number set to 8, the binding bitmap will be:</p><p>10000000 01000000 00100000 00010000 00001000 00000100 00000010 00000001</p></li><li><p>When the process number set to 10, the binding bitmap will be:</p><p>10000000 01000000 00100000 00010000 00001000 00000100 00000010 00000001 10000000 01000000</p></li></ul><p>When set to &#39;off&#39;, Tengine will disable the CPU affinity.</p><hr><blockquote><p>Syntax: <strong>error_page</strong> code ... [default] [=[response]]<br>Default: -<br>Context: http, server, location, if in location</p></blockquote><p>This directive can specify the page for the specific HTTP response status.</p><ul><li>Tengine also has a &#39;default&#39; parameter which can be used to clear the error_page settings in higher level blocks.</li></ul><p>For example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        error_page 404 default;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this server block, the 404 error page will be set to Tengine&#39;s default 404 page.</p><hr><blockquote><p>Syntax: <strong>request_time_cache</strong> [on | off]<br>Default: request_time_cache on<br>Context: http, server, location</p></blockquote><p>When set to &#39;off&#39;, Tengine will get a more precise time on $request_time, $request_time_msec, $request_time_usec because it does not use time cache.</p><hr><blockquote><p>Syntax: <strong>log_empty_request</strong> [on | off]<br>Default: log_empty_request on<br>Context: http, server, location</p></blockquote><p>When you specify it &#39;off&#39;, Tengine will not record any access log when a client issues a connection without any data being sent.<br>By default, it&#39;s on. In the above case, it will print a 400 Bad Request message into the access log.</p><hr><blockquote><p>Syntax: <strong>server_admin</strong> admin<br>Default: none<br>Context: http, server, location</p></blockquote><p>Specify the administrator&#39;s information, which will appear in a default 4xx/5xx error response when &#39;server_info&#39; is turned on.</p><hr><blockquote><p>Syntax: <strong>server_info</strong> on | off<br>Default: server_info on<br>Context: http, server, location</p></blockquote><p>Show up the server information in a default 4xx/5xx error response. The URL accessed by the user, the hostname serving the request, and the time are included.</p><hr><blockquote><p>Syntax: <strong>server_tag</strong> off | customized_tag<br>Default: none<br>Context: http, server, location</p></blockquote><p>Specify the customized &#39;Server&#39; header in the HTTP responses, for example, &#39;Apache/2.2.22&#39;, &#39;IIS 6.0&#39;, &#39;Lighttpd&#39;, etc. You could also suppress the &#39;Server&#39; header by setting it to &#39;off&#39;.</p><hr><blockquote><p>Syntax: <strong>reuse_port</strong> on | off<br>Default: reuse_port off<br>Context: events</p></blockquote><p>turn on support for SO_REUSEPORT socket option. This option is supported since Linux 3.9.</p><p>Note: Removed reuse_port directive after the Tengine-2.3.0 version and use the official reuseport of Nginx, detailed reference <a href="https://www.nginx.com/blog/socket-sharding-nginx-release-1-9-1/" target="_blank" rel="noopener">document</a>.</p><p><a href="benchmark.html">benchmark</a><br><!-- [benchmark](../download/reuseport.pdf) --></p><hr><blockquote><p>Syntax: <strong>pipe:rollback</strong> [logpath] <strong>interval=</strong>[interval] <strong>baknum=</strong>[baknum] <strong>maxsize=</strong>[maxsize]<br>Default: none<br>Context: http, server, location</p></blockquote><p>log pipe module write log use special log proccess, it may not block worker, worker communicate with log proccess use pipe, rollback depend on log pipe module, it support log file auto rollback by tengine self. it support rollback by time and file size, also can configure backup file number. log rollback module will rename log file to backup filename, then reopen the log file and write again</p><p>rollback configurge is built-in access_log and error_log：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">access_log &quot;pipe:rollback [logpath] interval=[interval] baknum=[baknum] maxsize=[maxsize]&quot; proxyformat;</span><br><span class="line"></span><br><span class="line">error_log  &quot;pipe:rollback [logpath] interval=[interval] baknum=[baknum] maxsize=[maxsize]&quot; info;</span><br></pre></td></tr></table></figure></p><p>logpath: log output file path and name</p><p>interval：log rollback interval, default 0 (never)</p><p>baknum：backup file number, default 1 (keep 1 backup file)</p><p>maxsize：log file max size, default 0 (never)</p><p>example：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">error_log  &quot;pipe:rollback logs/error_log interval=60m baknum=5 maxsize=2048M&quot; info;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line">    access_log  &quot;pipe:rollback logs/access_log interval=1h baknum=5 maxsize=2G&quot;  main;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><blockquote><p>Syntax: <strong>server_name</strong> name;<br>Default: —<br>Context: server</p></blockquote><p><code>server_name</code> used in Stream module makes Tengine have the ability to listen same ip:port in multiply server blocks and. The connection will be attached to a certain server block by SNI extension in TLS. That means <code>server_name</code> should be used with SSL offloading(using <code>ssl</code> after <code>listen</code>).<br>The <code>server_name</code> support in Stream module is not enabled by default. You should compile it explicitly:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./configure --with-stream_sni</span><br></pre></td></tr></table></figure><p>Note:<br>This feature is experimental. We will deprecate this feature if there is any conflict with similar feature of nginx official.</p><hr><blockquote><p>Syntax: <strong>ssl_sni_force</strong> on | off<br>Default: ssl_sni_force off<br>Context: stream, server</p></blockquote><p><code>ssl_sni_force</code> will determine whether the TLS handsheke is rejected or not if SNI is not matched with server name which we configure by <code>server_name</code> in Stream module.</p><p>Note:<br>Same note in <code>server_name</code> above.</p><hr><blockquote><p>Syntax: <strong>http2</strong> on | off<br>Default: http2 off<br>Context: http</p></blockquote><p>It makes Tengine have the ability to start/stop HTTP2 for a certain server block which listen the same ip:port.</p><p>example:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 http2;</span><br><span class="line">        server_name www.taobao.com;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        server_name www.tmall.com;</span><br><span class="line">        #Disable http2 for &quot;www.tmall.com&quot;</span><br><span class="line">        http2 off;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>