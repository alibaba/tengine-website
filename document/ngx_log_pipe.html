<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Name - The Tengine Web Server</title><meta name="description" content="asyn log and auto rollbackDescriptionlog pipe module write log use special log proccess, it may not block worker, worker communicate with log proccess use pipe, rollback depend on log pipe module, it"><meta property="og:type" content="article"><meta property="og:title" content="Name"><meta property="og:url" content="http://tengine.taobao.org/document/ngx_log_pipe.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="asyn log and auto rollbackDescriptionlog pipe module write log use special log proccess, it may not block worker, worker communicate with log proccess use pipe, rollback depend on log pipe module, it"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-11-10T04:04:29.162Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Name"><meta name="twitter:description" content="asyn log and auto rollbackDescriptionlog pipe module write log use special log proccess, it may not block worker, worker communicate with log proccess use pipe, rollback depend on log pipe module, it"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Tengine-Ingress</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/ngx_log_pipe" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Name</h1></header><div class="article-entry" itemprop="articleBody"><p>asyn log and auto rollback</p><h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><p>log pipe module write log use special log proccess, it may not block worker, worker communicate with log proccess use pipe, rollback depend on log pipe module, it support log file auto rollback by tengine self. it support rollback by time and file size, also can configure backup file number. log rollback module will rename log file to backup filename, then reopen the log file and write again</p><h1 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h1><p>Syntax: <strong>pipe:rollback</strong> [logpath] <strong>interval=</strong>[interval] <strong>baknum=</strong>[baknum] <strong>maxsize=</strong>[maxsize] <strong>adjust=</strong>[adjust]<br>Default: none<br>Context: http, server, location</p><p>rollback configurge is built-in access_log and error_log：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">access_log &quot;pipe:rollback [logpath] interval=[interval] baknum=[baknum] maxsize=[maxsize] adjust=[adjust]&quot; proxyformat;</span><br><span class="line"></span><br><span class="line">error_log  &quot;pipe:rollback [logpath] interval=[interval] baknum=[baknum] maxsize=[maxsize] adjust=[adjust]&quot; info;</span><br></pre></td></tr></table></figure></p><p>logpath: log output file path and name</p><p>interval：log rollback interval, default 0 (never)</p><p>baknum：backup file number, default 1 (keep 1 backup file)</p><p>maxsize：log file max size, default 0 (never)</p><p>adjust: delay random rollback time when rollback by interval, to avoid all server focus on rollback default 60 (60s)</p><p>example：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">error_log  &quot;pipe:rollback logs/error_log interval=60m baknum=5 maxsize=2048M&quot; info;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">	log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line">	access_log  &quot;pipe:rollback logs/access_log interval=1h baknum=5 maxsize=2G&quot;  main;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>