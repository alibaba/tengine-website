<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>Standard - The Tengine Web Server</title><meta name="description" content="ngx_http_dubbo_moduleThis module provides support for the backend Dubbo support after Tengine version 2.3.2.Apache Dubbo™ is a high-performance, java based open source RPC framework.It is open source"><meta property="og:type" content="article"><meta property="og:title" content="Standard"><meta property="og:url" content="http://tengine.taobao.org/document/ngx_http_dubbo_module.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="ngx_http_dubbo_moduleThis module provides support for the backend Dubbo support after Tengine version 2.3.2.Apache Dubbo™ is a high-performance, java based open source RPC framework.It is open source"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-11-09T13:09:23.167Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Standard"><meta name="twitter:description" content="ngx_http_dubbo_moduleThis module provides support for the backend Dubbo support after Tengine version 2.3.2.Apache Dubbo™ is a high-performance, java based open source RPC framework.It is open source"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Tengine-Ingress</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/ngx_http_dubbo_module" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Standard</h1></header><div class="article-entry" itemprop="articleBody"><h1 id="ngx-http-dubbo-module"><a href="#ngx-http-dubbo-module" class="headerlink" title="ngx_http_dubbo_module"></a>ngx_http_dubbo_module</h1><p>This module provides support for the backend Dubbo support after Tengine version 2.3.2.<br><a href="http://dubbo.apache.org" target="_blank" rel="noopener">Apache Dubbo™</a> is a high-performance, java based open source RPC framework.It is open source by Alibaba, in years of development, it is one of the most popular microservice framework.</p><p>There are two roles Consumer(client) and Provider(Server) in Dubbo. This module is used to make Tengine as a proxy gateway which receives HTTP/HTTPS/HTTP2 requests at the front then as a Dubbo Consumer passes the requests to backend Dubbo Provider service.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User                 tengine (dubbo_pass)                         Dubbo Service Provider</span><br><span class="line">  |                          |                                              |</span><br><span class="line">  |--- GET github.com:443 --&gt;|                                              |</span><br><span class="line">  |                          |--- Dubbo Multiplexing Binary RPC Request  --&gt;|</span><br><span class="line">  |                          |                                              |</span><br><span class="line">  |                          |&lt;-- Dubbo Multiplexing Binary RPC Response ---|</span><br><span class="line">  |&lt;--    HTTP/1.1 200    ---|                                              |</span><br></pre></td></tr></table></figure><h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><h2 id="Tengine-Configuration-Example"><a href="#Tengine-Configuration-Example" class="headerlink" title="Tengine Configuration Example"></a>Tengine Configuration Example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream dubbo_backend &#123;</span><br><span class="line">    multi 1;</span><br><span class="line">    server 127.0.0.1:20880;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8080;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        dubbo_pass org.apache.dubbo.demo.DemoService 0.0.0 http_dubbo_tengine dubbo_backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Dubbo-Demo-Service-Example"><a href="#Dubbo-Demo-Service-Example" class="headerlink" title="Dubbo Demo Service Example"></a>Dubbo Demo Service Example</h2><h3 id="Standard"><a href="#Standard" class="headerlink" title="Standard"></a>Standard</h3><p>Dubbo Provider need implement this interface, then configure the service name, Service version and service method to<figure class="highlight plain"><figcaption><span>like this. Tengine will convert HTTP/HTTPS/HTTP2 request to Dubbo interface invoke.</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>Map&lt;String, Object&gt; dubbo_method(Map&lt;String, Object&gt; context);</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Input param ```Map&lt;String, Object&gt; context``` with a number of key and value， you can use ```dubbo_pass_set```,```dubbo_pass_all_headers```,```dubbo_pass_body``` directives to div them, last key is the retained field:</span><br></pre></td></tr></table></figure><p>body: HTTP request Body, value Object type is byte[]</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">For output param ```Map&lt;String, Object&gt; context```, last key is the retained field:</span><br></pre></td></tr></table></figure><p>body: HTTP response Body, value Object type is byte[]<br>statue: HTTP response Status, value type is String<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### Extend(Stay tuned for updates)</span><br><span class="line"></span><br><span class="line">Support configure param mapping on Tengine, support invoke any Dubbo Provider method not need any change (Stay tuned for updates).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">QuickStart</span><br><span class="line">=======</span><br><span class="line">This is a [QuickStart for Tengine Dubbo](https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-tengine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Install</span><br><span class="line">=======</span><br><span class="line"></span><br><span class="line">Build Tengine with this module from source:</span><br></pre></td></tr></table></figure></p><p>$ ./configure --add-module=./modules/mod_dubbo --add-module=./modules/ngx_multi_upstream_module --add-module=./modules/mod_config<br>$ make &amp;&amp; make install<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Dynamic module support</span><br><span class="line"></span><br><span class="line">* mod_dubbo: ```support``` build as a dynamic module</span><br><span class="line">* ngx_multi_upstream_module: ```no support``` build as a dynamic module</span><br><span class="line">* mod_config: ```support but no need``` build as a dynamic module</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Directive</span><br><span class="line">=========</span><br><span class="line"></span><br><span class="line">dubbo_pass</span><br><span class="line">-------------</span><br><span class="line">Syntax: **dubbo_pass** *service_name* *service_version* *method* *upstream_name*  </span><br><span class="line">Default: `none`  </span><br><span class="line">Context: `location, if in location` </span><br><span class="line"></span><br><span class="line">configure use Dubbo protocol proxy to upstream</span><br><span class="line"></span><br><span class="line">* *service_name*: Dubbo provider service name</span><br><span class="line">* *service_version*: Dubbo provider service version</span><br><span class="line">* *method*: Dubbo provider service method</span><br><span class="line">* *upstream_name*: backend upstream name</span><br><span class="line"></span><br><span class="line">Nginx variables can be used as `service_name`, `service_version` and `method`.</span><br></pre></td></tr></table></figure></p><h1 id="proxy-to-upstream-dubbo-backend"><a href="#proxy-to-upstream-dubbo-backend" class="headerlink" title="proxy to upstream dubbo_backend"></a>proxy to upstream dubbo_backend</h1><p>upstream dubbo_backend {<br>multi 1;<br>server 127.0.0.1:20880;<br>}</p><p>set $dubbo_service_name &quot;org.apache.dubbo.demo.DemoService&quot;;<br>set $dubbo_service_name &quot;0.0.0&quot;;<br>set $dubbo_service_name &quot;http_dubbo_nginx&quot;;</p><p>dubbo_pass $dubbo_service_name $dubbo_service_version $dubbo_method dubbo_backend;<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Notice:</span><br><span class="line"></span><br><span class="line">`dubbo_pass` only support multi upstream, must use `multi` configure in upstream, multi param is number of multiplexing connection.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dubbo_pass_set</span><br><span class="line">-------------------</span><br><span class="line"></span><br><span class="line">Syntax: **dubbo_pass_set** *key* *value*;</span><br><span class="line">Default: `none`</span><br><span class="line">Context: `location, if in location`</span><br><span class="line"></span><br><span class="line">When proxy request to backend, need pass this key-value, key and value can contain variables.</span><br></pre></td></tr></table></figure></p><p>dubbo_pass_set username $cookie_user;<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">dubbo_pass_all_headers</span><br><span class="line">-----------------------------</span><br><span class="line"></span><br><span class="line">Syntax: **dubbo_pass_all_headers** on | off;</span><br><span class="line">Default: `off`</span><br><span class="line">Context: `location, if in location`</span><br><span class="line"></span><br><span class="line">Enables or disables passing all http header to backend as key-value.</span><br><span class="line"></span><br><span class="line">dubbo_pass_body</span><br><span class="line">--------------------------</span><br><span class="line"></span><br><span class="line">Syntax: **dubbo_pass_body** on | off;</span><br><span class="line">Default: `on`</span><br><span class="line">Context: `location, if in location`</span><br><span class="line"></span><br><span class="line">Enables or disables passing request body to backend.</span><br><span class="line"></span><br><span class="line">dubbo_heartbeat_interval</span><br><span class="line">--------------------------</span><br><span class="line"></span><br><span class="line">Syntax: **dubbo_heartbeat_interval** *time*;</span><br><span class="line">Default: `60s`</span><br><span class="line">Context: `http, server, location`</span><br><span class="line"></span><br><span class="line">Defines a interval for auto sending ping frame to backend.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dubbo_bind</span><br><span class="line">--------------------------</span><br><span class="line"></span><br><span class="line">Syntax:	  **dubbo_bind**  *address* [transparent ] | off;</span><br><span class="line">Default: `off`</span><br><span class="line">Context: `http, server, location`</span><br><span class="line"></span><br><span class="line">Like ```proxy_bind```. makes outgoing connections to a Dubbo provider originate from the specified local IP address with an optional port. Parameter value can contain variables. The special value off cancels the effect of the dubbo_bind directive inherited from the previous configuration level, which allows the system to auto-assign the local IP address and port.</span><br><span class="line"></span><br><span class="line">The transparent parameter allows outgoing connections to a Dubbo provider originate from a non-local IP address, for example, from a real IP address of a client:</span><br></pre></td></tr></table></figure></p><p>dubbo_bind $remote_addr transparent;<br><code>`</code><br>In order for this parameter to work, it is usually necessary to run nginx worker processes with the superuser privileges. On Linux it is not required as if the transparent parameter is specified, worker processes inherit the CAP_NET_RAW capability from the master process. It is also necessary to configure kernel routing table to intercept network traffic from the Dubbo provider.</p><h2 id="dubbo-socket-keepalive"><a href="#dubbo-socket-keepalive" class="headerlink" title="dubbo_socket_keepalive"></a>dubbo_socket_keepalive</h2><p>Syntax: <strong>dubbo_socket_keepalive</strong> on | off;<br>Default: <code>off</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_socket_keepalive</code>, configures the &quot;TCP keepalive&quot; behavior for outgoing connections to a Dubbo provider. By default, the operating system&#39;s settings are in effect for the socket. If the directive is set to the value &quot;on&quot;, the SO_KEEPALIVE socket option is turned on for the socket.</p><h2 id="dubbo-connect-timeout"><a href="#dubbo-connect-timeout" class="headerlink" title="dubbo_connect_timeout"></a>dubbo_connect_timeout</h2><p>Syntax: <strong>dubbo_connect_timeout</strong> <em>time</em>;<br>Default: <code>60s</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_connect_timeout</code>, defines a timeout for establishing a connection with a Dubbo provider. It should be noted that this timeout cannot usually exceed 75 seconds.</p><h2 id="dubbo-send-timeout"><a href="#dubbo-send-timeout" class="headerlink" title="dubbo_send_timeout"></a>dubbo_send_timeout</h2><p>Syntax: <strong>dubbo_send_timeout</strong> <em>time</em>;<br>Default: <code>60s</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_send_timeout</code>, sets a timeout for transmitting a request to the Dubbo provider. The timeout is set only between two successive write operations, not for the transmission of the whole request. If the Dubbo provider does not receive anything within this time, the connection is closed.</p><h2 id="dubbo-read-timeout"><a href="#dubbo-read-timeout" class="headerlink" title="dubbo_read_timeout"></a>dubbo_read_timeout</h2><p>Syntax: <strong>dubbo_read_timeout</strong> <em>time</em>;<br>Default: <code>60s</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_read_timeout</code>, defines a timeout for reading a response from the Dubbo provider. The timeout is set only between two successive read operations, not for the transmission of the whole response. If the Dubbo provider does not transmit anything within this time, the connection is closed.</p><h2 id="dubbo-intercept-errors"><a href="#dubbo-intercept-errors" class="headerlink" title="dubbo_intercept_errors"></a>dubbo_intercept_errors</h2><p>Syntax: <strong>dubbo_intercept_errors</strong> on | off;<br>Default: <code>off</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_intercept_errors</code>, determines whether Dubbo provider responses with codes greater than or equal to 300 should be passed to a client or be intercepted and redirected to nginx for processing with the <code>error_page</code> directive.</p><h2 id="dubbo-buffer-size"><a href="#dubbo-buffer-size" class="headerlink" title="dubbo_buffer_size"></a>dubbo_buffer_size</h2><p>Syntax: <strong>dubbo_buffer_size</strong> <em>size</em>;<br>Default: <code>4k|8k</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_buffer_size</code>, sets the size of the buffer used for reading the response received from the Dubbo provider. The response is passed to the client synchronously, as soon as it is received.</p><h2 id="dubbo-next-upstream"><a href="#dubbo-next-upstream" class="headerlink" title="dubbo_next_upstream"></a>dubbo_next_upstream</h2><p>Syntax: <strong>dubbo_next_upstream</strong> error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | off ...;<br>Default: <code>error timeout</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_next_upstream</code>, specifies in which cases a request should be passed to the next server.</p><h2 id="dubbo-next-upstream-tries"><a href="#dubbo-next-upstream-tries" class="headerlink" title="dubbo_next_upstream_tries"></a>dubbo_next_upstream_tries</h2><p>Syntax: <strong>dubbo_next_upstream_tries</strong> <em>number</em>;<br>Default: <code>0</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_next_upstream_tries</code>, limits the number of possible tries for passing a request to the next server. The 0 value turns off this limitation.</p><h2 id="dubbo-next-upstream-timeout"><a href="#dubbo-next-upstream-timeout" class="headerlink" title="dubbo_next_upstream_timeout"></a>dubbo_next_upstream_timeout</h2><p>Syntax: <strong>dubbo_next_upstream_timeout</strong> <em>timer</em>;<br>Default: <code>0</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_next_upstream_tries</code>, limits the time during which a request can be passed to the next server. The 0 value turns off this limitation.</p><h2 id="dubbo-pass-header"><a href="#dubbo-pass-header" class="headerlink" title="dubbo_pass_header"></a>dubbo_pass_header</h2><p>Syntax: <strong>dubbo_pass_header</strong> <em>field</em>;<br>Default: <code>none</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_pass_header</code>, permits passing otherwise disabled header fields from a Dubbo provider to a client.</p><h2 id="dubbo-hide-header"><a href="#dubbo-hide-header" class="headerlink" title="dubbo_hide_header"></a>dubbo_hide_header</h2><p>Syntax: <strong>dubbo_hide_header</strong> <em>field</em>;<br>Default: <code>none</code><br>Context: <code>http, server, location</code></p><p>Like <code>proxy_hide_header</code>, by default, tengine does not pass the header fields &quot;Date&quot;, &quot;Server&quot;, and &quot;X-Accel-...&quot; from the response of a Dubbo provider to a client. The dubbo_hide_header directive sets additional fields that will not be passed. If, on the contrary, the passing of fields needs to be permitted, the dubbo_pass_header directive can be used.</p><h1 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h1></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>