<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta name="generator" content="Hexo 3.9.0"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SNH2MHXGCW"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SNH2MHXGCW');</script><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><title>简介 - The Tengine Web Server</title><meta name="description" content="Tengine-Ingress由两部分组成，Tengine-Ingress控制器和Tengine-proxy。Tengine-Ingress控制器是一个基于Tengine-proxy的ingress控制器，在兼容云原生ingress标准规范的基础上扩展了Server，Backend，TLS，Location和Canary。Tengine-Ingress控制器通过订阅和处理ingress域名资源和s"><meta property="og:type" content="article"><meta property="og:title" content="简介"><meta property="og:url" content="http://tengine.taobao.org/document/ingress_install.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="Tengine-Ingress由两部分组成，Tengine-Ingress控制器和Tengine-proxy。Tengine-Ingress控制器是一个基于Tengine-proxy的ingress控制器，在兼容云原生ingress标准规范的基础上扩展了Server，Backend，TLS，Location和Canary。Tengine-Ingress控制器通过订阅和处理ingress域名资源和s"><meta property="og:locale" content="default"><meta property="og:image" content="http://tengine.taobao.org/book/_images/tengine_ingress_container.png"><meta property="og:image" content="http://tengine.taobao.org/book/_images/tengine_ingress_vers_table.png"><meta property="og:updated_time" content="2023-11-06T02:40:24.950Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="简介"><meta name="twitter:description" content="Tengine-Ingress由两部分组成，Tengine-Ingress控制器和Tengine-proxy。Tengine-Ingress控制器是一个基于Tengine-proxy的ingress控制器，在兼容云原生ingress标准规范的基础上扩展了Server，Backend，TLS，Location和Canary。Tengine-Ingress控制器通过订阅和处理ingress域名资源和s"><meta name="twitter:image" content="http://tengine.taobao.org/book/_images/tengine_ingress_container.png"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="container-fluid"><div class="row global-header"><div class="container"><div class="row"><div class="col-lg-12"><div class="row"><div class="navbar-header col-lg-2 col-xs-12"><button aria-controls="nav-menu" aria-expanded="false" class="navbar-toggle collapsed" data-target="#nav-menu" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><h1 class="text-muted site-logo navbar-brand"><a href="/" id="logo" class="text-hide">The Tengine Web Server</a></h1></div><div class="col-lg-10 col-xs-12"><nav id="nav-menu" class="navbar-collapse collapse" aria-expanded="false"><ul class="nav navbar-nav navbar-right"><li role="presentation"><a class="menu-item" href="/documentation.html">Tengine</a></li><li role="presentation"><a class="menu-item" href="/ingress.html">Ingress</a></li><li role="presentation"><a class="menu-item" href="/guide.html">Guide</a></li><li role="presentation"><a class="menu-item" href="/blog.html">Blog</a></li><li role="presentation"><a class="menu-item" href="/download.html">Download</a></li><li role="presentation"><a class="menu-item" href="/source.html">Source</a></li><li role="presentation"><a class="menu-item" href="/contact.html">Contact</a></li><li role="presentation"><a class="menu-item" href="/faq.html">FAQ</a></li><li role="presentation" class="col-hide-xs"><select class="lang-switch pull-right"></select></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav></div></div></div></div></div></div></div><div class="container-fluid" id="main"><section class="row"><div class="fluid-container"><div class="container"><article id="post-document/ingress_install" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">简介</h1></header><div class="article-entry" itemprop="articleBody"><p><code>Tengine-Ingress</code>由两部分组成，<a href="https://github.com/alibaba/tengine-ingress" target="_blank" rel="noopener">Tengine-Ingress控制器</a>和<a href="https://github.com/alibaba/tengine" target="_blank" rel="noopener">Tengine-proxy</a>。Tengine-Ingress控制器是一个基于Tengine-proxy的ingress控制器，在兼容云原生<a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">ingress</a>标准规范的基础上扩展了Server，Backend，TLS，Location和Canary。</p><p><code>Tengine-Ingress</code>控制器通过订阅和处理ingress域名资源和secret证书资源，基于tengine ingress模板转换为动态配置写入共享内存。Tengine-proxy订阅共享内存变化写入内部运行时共享内存，将终端用户的外部流量路由到K8s集群中的应用服务。</p><p><img src="/book/_images/tengine_ingress_container.png" alt="image"></p><h2 id="使用官方镜像"><a href="#使用官方镜像" class="headerlink" title="使用官方镜像"></a>使用官方镜像</h2><p>支持操作系统：<a href="https://hub.docker.com/r/openanolis/anolisos" target="_blank" rel="noopener">Anolis</a>, <a href="https://hub.docker.com/_/alpine" target="_blank" rel="noopener">Alpine</a><br>支持系统架构：AMD64, ARM64</p><p><a href="https://hub.docker.com/r/openanolis/anolisos" target="_blank" rel="noopener">Anolis</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull tengine-ingress-registry.cn-hangzhou.cr.aliyuncs.com/tengine/tengine-ingress:1.1.0</span><br></pre></td></tr></table></figure></p><p><a href="https://hub.docker.com/_/alpine" target="_blank" rel="noopener">Alpine</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull tengine-ingress-registry.cn-hangzhou.cr.aliyuncs.com/tengine/tengine-ingress:1.1.0-alpine</span><br></pre></td></tr></table></figure></p><p><img src="/book/_images/tengine_ingress_vers_table.png" alt="image"></p><h2 id="自助编译镜像"><a href="#自助编译镜像" class="headerlink" title="自助编译镜像"></a>自助编译镜像</h2><h3 id="第一步：构建tengine镜像"><a href="#第一步：构建tengine镜像" class="headerlink" title="第一步：构建tengine镜像"></a>第一步：构建tengine镜像</h3><ul><li><a href="https://hub.docker.com/r/openanolis/anolisos" target="_blank" rel="noopener">Anolis</a>: <code>BASE_IMAGE=&quot;docker.io/openanolis/anolisos:latest&quot;</code>, <code>LINUX_RELEASE=&quot;anolisos&quot;</code></li><li><a href="https://hub.docker.com/_/alpine" target="_blank" rel="noopener">Alpine</a>: <code>BASE_IMAGE=&quot;alpine:latest&quot;</code>, <code>LINUX_RELEASE=&quot;alpine&quot;</code><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker build --no-cache --build-arg BASE_IMAGE="docker.io/openanolis/anolisos:latest" --build-arg LINUX_RELEASE="anolisos" -t tengine:3.1.0 images/tengine/rootfs/</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="第二步：构建tengine-ingress镜像"><a href="#第二步：构建tengine-ingress镜像" class="headerlink" title="第二步：构建tengine-ingress镜像"></a>第二步：构建tengine-ingress镜像</h3><p>在tengine镜像基础上，构建tengine-ingress镜像<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker build --no-cache --build-arg BASE_IMAGE="tengine:3.1.0" --build-arg VERSION="1.1.0" -f build/Dockerfile -t tengine-ingress:1.1.0 .</span></span><br></pre></td></tr></table></figure></p><h3 id="最后，使用tengine-ingress镜像部署您的网关。"><a href="#最后，使用tengine-ingress镜像部署您的网关。" class="headerlink" title="最后，使用tengine-ingress镜像部署您的网关。"></a>最后，使用tengine-ingress镜像部署您的网关。</h3><h2 id="启动命令行参数"><a href="#启动命令行参数" class="headerlink" title="启动命令行参数"></a>启动命令行参数</h2><blockquote><p>参数名称: <code>--configmap</code><br>参数值: <code>${tengine-configuration}</code></p></blockquote><p><code>Tengine-Ingress</code>的全局配置，示例如下：<br><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">access-log-path:</span> <span class="string">'"pipe:rollback /home/admin/tengine-ingress/logs/tengine-access.log baknum=10 maxsize=5G interval=1d adjust=600"'</span></span><br><span class="line">  <span class="attr">allow-backend-server-header:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">client-body-buffer-size:</span> <span class="string">3m</span></span><br><span class="line">  <span class="attr">client-header-timeout:</span> <span class="string">"60"</span></span><br><span class="line">  <span class="attr">default-type:</span> <span class="string">application/octet-stream</span></span><br><span class="line">  <span class="attr">enable-multi-accept:</span> <span class="string">"false"</span></span><br><span class="line">  <span class="attr">enable-real-ip:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">enable-underscores-in-headers:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">error-log-level:</span> <span class="string">warn</span></span><br><span class="line">  <span class="attr">error-log-path:</span> <span class="string">'"pipe:rollback /home/admin/tengine-ingress/logs/tengine-error.log baknum=10 maxsize=2G interval=1d adjust=600"'</span></span><br><span class="line">  <span class="attr">forwarded-for-header:</span> <span class="string">X-Forwarded-For</span></span><br><span class="line">  <span class="attr">gzip-level:</span> <span class="string">"1"</span></span><br><span class="line">  <span class="attr">gzip-min-length:</span> <span class="string">"1024"</span></span><br><span class="line">  <span class="attr">gzip-types:</span> <span class="string">application/atom+xml</span> <span class="string">application/javascript</span> <span class="string">application/x-javascript</span></span><br><span class="line">    <span class="string">application/json</span> <span class="string">application/rss+xml</span> <span class="string">application/vnd.ms-fontobject</span> <span class="string">application/x-font-ttf</span></span><br><span class="line">    <span class="string">application/x-web-app-manifest+json</span> <span class="string">application/xhtml+xml</span> <span class="string">application/xml</span> <span class="string">font/opentype</span></span><br><span class="line">    <span class="string">image/svg+xml</span> <span class="string">image/x-icon</span> <span class="string">text/css</span> <span class="string">text/javascript</span> <span class="string">text/plain</span> <span class="string">text/x-component</span></span><br><span class="line">    <span class="string">text/xml</span></span><br><span class="line">  <span class="attr">http-redirect-code:</span> <span class="string">"301"</span></span><br><span class="line">  <span class="attr">http-snippet:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">sendfile</span>                           <span class="string">on;</span> </span><br><span class="line">    <span class="string">postpone_output</span>                    <span class="number">0</span><span class="string">;</span> </span><br><span class="line">    <span class="string">send_timeout</span>                       <span class="string">60s;</span> </span><br><span class="line">    <span class="string">req_status_zone</span> <span class="string">server</span> <span class="string">"$log_host"</span> <span class="string">512M;</span> </span><br><span class="line">    <span class="string">req_status</span>                         <span class="string">server;</span> </span><br><span class="line">    <span class="string">req_status_bypass</span>                  <span class="string">$no_reqstatus;</span> </span><br><span class="line">    <span class="string">expires</span>                            <span class="string">off;</span> </span><br><span class="line">    <span class="string">error_page</span> <span class="number">509</span> <span class="string">@wait;</span> </span><br><span class="line">    <span class="string">server_info</span>                        <span class="string">on;</span> </span><br><span class="line">    <span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm;</span> </span><br><span class="line">    <span class="string">log_not_found</span>                      <span class="string">off;</span> </span><br><span class="line">    <span class="string">gzip_disable</span>                       <span class="string">msie6;</span> </span><br><span class="line">    <span class="string">gzip_buffers</span>                       <span class="number">96</span> <span class="string">8k;</span> </span><br><span class="line">    <span class="string">sysguard</span> <span class="string">off;</span></span><br><span class="line">  <span class="attr">http3-xquic-default-cert:</span> <span class="string">/etc/ingress-controller/ssl/default-fake-certificate.pem</span></span><br><span class="line">  <span class="attr">http3-xquic-default-key:</span> <span class="string">/etc/ingress-controller/ssl/default-fake-certificate.pem</span></span><br><span class="line">  <span class="attr">large-client-header-buffers:</span> <span class="number">4</span> <span class="string">32k</span></span><br><span class="line">  <span class="attr">log-format-upstream:</span> <span class="string">$time_local|$status|$upstream_status|$http_x_appkey|$remote_addr|$upstream_addr|$request_time|$upstream_response_time|$request_method|$scheme|$host|$server_port|$request_uri|$body_bytes_sent|$http_referer|$http_user_agent|$proxy_add_x_forwarded_for|$http_x_forwarded_for|$http_ns_client_ip|$http_accept_language|$connection_requests|$ssl_protocol|$ssl_cipher|$ssl_session_reused|$sent_http_set_cookie|$http_resp_cookie_govern|$cookie_cookie2|$cookie_thw|$sent_http_x_cache|$cookie_unb|$host|$request_length|$bytes_sent|$ingress_route_target|$xquic|$xquic_off|$xquic_connection_id|$xquic_stream_id|$xquic_ssl_protocol|$xquic_ssl_cipher|$xquic_ssl_session_reused|</span></span><br><span class="line">  <span class="attr">lua-shared-dicts:</span> <span class="string">'configuration_data: 160, certificate_data: 160, certificate_servers: 40'</span></span><br><span class="line">  <span class="attr">main-snippet:</span> </span><br><span class="line">   <span class="string">"worker_rlimit_core    20000000000; \n</span></span><br><span class="line"><span class="string">    error_log  \"pipe:rollback /home/admin/tengine-ingress/logs/tengine-error.log baknum=10 maxsize=2G interval=1d adjust=600\" warn; \n</span></span><br><span class="line"><span class="string">    xquic_log  \"pipe:rollback /home/admin/tengine-ingress/logs/tengine-xquic.log baknum=10 maxsize=1G interval=1d adjust=600\" info;\n</span></span><br><span class="line"><span class="string">    master_env NGX_DNS_RESOLVE_BACKUP_PATH=/home/admin/tengine-ingress/conf/local/dns/;\n"</span></span><br><span class="line">  <span class="attr">map-hash-bucket-size:</span> <span class="string">"256"</span></span><br><span class="line">  <span class="attr">max-worker-connections:</span> <span class="string">"40960"</span></span><br><span class="line">  <span class="attr">max-worker-open-files:</span> <span class="string">"100000"</span></span><br><span class="line">  <span class="attr">nginx-status-ipv4-whitelist:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/8,11.0.0.0/8,172.16.0.0/12,127.0.0.1/32,192.168.0.0/16,33.0.0.0/8</span></span><br><span class="line">  <span class="attr">proxy-body-size:</span> <span class="string">4096m</span></span><br><span class="line">  <span class="attr">proxy-buffer-size:</span> <span class="string">64k</span></span><br><span class="line">  <span class="attr">proxy-buffers-number:</span> <span class="string">"256"</span></span><br><span class="line">  <span class="attr">proxy-connect-timeout:</span> <span class="string">"60"</span></span><br><span class="line">  <span class="attr">proxy-headers-hash-bucket-size:</span> <span class="string">"128"</span></span><br><span class="line">  <span class="attr">proxy-headers-hash-max-size:</span> <span class="string">"1024"</span></span><br><span class="line">  <span class="attr">proxy-http-version:</span> <span class="string">"1.1"</span></span><br><span class="line">  <span class="attr">proxy-next-upstream:</span> <span class="string">error</span> <span class="string">timeout</span> <span class="string">invalid_header</span> <span class="string">http_500</span> <span class="string">http_502</span> <span class="string">http_503</span> <span class="string">http_504</span></span><br><span class="line">  <span class="attr">proxy-next-upstream-tries:</span> <span class="string">"1"</span></span><br><span class="line">  <span class="attr">proxy-read-timeout:</span> <span class="string">"60"</span></span><br><span class="line">  <span class="attr">proxy-redirect-from:</span> <span class="string">"off"</span></span><br><span class="line">  <span class="attr">proxy-send-timeout:</span> <span class="string">"60"</span></span><br><span class="line">  <span class="attr">server-name-hash-bucket-size:</span> <span class="string">"128"</span></span><br><span class="line">  <span class="attr">server-name-hash-max-size:</span> <span class="string">"4096"</span></span><br><span class="line">  <span class="attr">server-tokens:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">ssl-ciphers:</span> <span class="string">ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-SHA:AES256-SHA:RSA+3DES:!DES-CBC3-SHA:!aNULL:!eNULL:!LOW:!MD5:!EXP:!DSS:!PSK:!SRP:!kECDH:!CAMELLIA:!IDEA:!SEED;</span></span><br><span class="line">  <span class="attr">ssl-protocols:</span> <span class="string">TLSv1</span> <span class="string">TLSv1.1</span> <span class="string">TLSv1.2</span> <span class="string">TLSv1.3</span></span><br><span class="line">  <span class="attr">upstream-keepalive-timeout:</span> <span class="string">"40"</span></span><br><span class="line">  <span class="attr">use-gzip:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">variables-hash-bucket-size:</span> <span class="string">"256"</span></span><br><span class="line">  <span class="attr">variables-hash-max-size:</span> <span class="string">"2048"</span></span><br><span class="line">  <span class="attr">worker-cpu-affinity:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">worker-processes:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">worker-shutdown-timeout:</span> <span class="string">300s</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tengine-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">alibaba-ingress-tao</span></span><br></pre></td></tr></table></figure></p><hr><blockquote><p>参数名称: <code>--annotations-prefix</code><br>默认值: <code>nginx.ingress.kubernetes.io</code></p></blockquote><p>设置<code>Tengine-Ingress</code>注解的默认前缀，默认前缀为<code>nginx.ingress.kubernetes.io</code>。</p><hr><blockquote><p>参数名称: <code>--v</code><br>参数值: <code>${log_level}</code></p></blockquote><p>设置<code>Tengine-Ingress</code>的日志级别，日志级别范围1..5，最大日志级别5属于debug模式。</p><hr><blockquote><p>参数名称: <code>--kubeconfig</code><br>参数值: <code>${ing_kubeconfig}</code></p></blockquote><p><code>Tengine-Ingress</code>支持K8s core集群与K8s ingress存储集群相隔离的高可靠性部署方案，将运行态和存储态相分离，独立K8s ingress集群可以保证自身API服务器和etcd性能稳定，并且在core集群核心组件API服务器和etcd不可用的高危场景下也能正常向外提供7层转发服务。</p><hr><blockquote><p>参数名称: <code>--watch-namespace</code><br>参数值: <code>${watch_namespace}</code></p></blockquote><p>设置<code>Tengine-Ingress</code>监听处理的命名空间</p><ul><li><code>Tengine-Ingress</code>只监听处理环境变量<code>watch_namespace</code>指定命名空间下的K8s资源对象。</li><li>K8s资源对象包括Ingress，Secret，Service等相关配置资源。</li><li>如果${watch_namespace}`为空，则监听所有命名空间下的资源对象。</li></ul><hr><blockquote><p>参数名称: <code>--controller-class</code><br>参数值: <code>${controller_class}</code></p></blockquote><p>设置<code>Tengine-Ingress</code>的类别</p><ul><li>在Kubernetes 1.19.0及其更高版本，通过IngressClass资源对象定义Ingress资源对象的类别。</li><li>IngressClass的.spec.controller值与<code>Tengine-Ingress</code>启动参数${controller_class}值保持一致，则<code>Tengine-Ingress</code>才会监听处理对应的Ingress资源对象。</li></ul></div></div></article></div></div></section></div><div class="container-fluid global-footer"><div class="row"><div class="container"><div class="row"><div class="col-lg-6 col-xs-6"><div class="footer-logo"></div></div><div class="col-lg-6 col-xs-6 clearfix"><select class="lang-switch pull-right"></select></div><div class="col-lg-12 col-lg-offset-0 col-xs-offset-1 col-xs-10"><span class="footer-text copyright">&copy; 2011-2023 <a href="https://www.alibabagroup.com/" target="_blank">Alibaba Group</a>. All rights reserved.</span> <span class="footer-text design-by">Designed by Aliyun UED AX, Proudly powered by <a href="https://github.com/alibaba/tengine-ingress" target="_blank">Tengine-Ingress</a> on <a href="https://www.aliyun.com/" target="_blank">Aliyun</a>.</span></div></div></div></div></div><script src="/js/base.min.js"></script><script src="/js/app.min.js"></script></body></html>